import{c as G,r as l,e as m,u as H,f as J,j as e,g as Q,X as v,h,i as U,T as V,P as W}from"./index-CBp3GSCB.js";import{U as C,C as Z}from"./users-4Vnw4V3a.js";import{E as O}from"./eye-yGmyv5bi.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=G("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),ae=({isOpen:r,onClose:b,currentClassId:i,onSelectClass:D,currentUser:o,onViewUserStudents:y})=>{const[c,$]=l.useState([]),[E,_]=l.useState([]),[L,B]=l.useState([]),[P,F]=l.useState(!0),[A,p]=l.useState(!1),[M,f]=l.useState(null),[u,g]=l.useState(""),[j,N]=l.useState(""),[R,T]=l.useState(null);l.useEffect(()=>{if(!r)return;F(!0);const s=m.subscribe(t=>{$(t),F(!1)});return()=>s()},[r]),l.useEffect(()=>{if(!r||!a)return;const s=H.subscribeAll(t=>{_(t)});return()=>s()},[r]),l.useEffect(()=>{if(!r)return;const s=J.subscribe(t=>{B(t)});return()=>s()},[r]);const x=(s=>s!=null&&s.customSchoolName?`${s.customSchoolCity||""}_${s.customSchoolName}`.trim():null)(o),a=(o==null?void 0:o.role)==="admin",w=l.useMemo(()=>{if(a)return c;const s=(o==null?void 0:o.assignedClasses)||[];return c.filter(t=>!(!s.includes(t.id)||t.schoolId&&x&&t.schoolId!==x))},[c,o,a,x]),I=l.useMemo(()=>{const s={};return c.forEach(t=>{s[t.id]=E.filter(d=>(d.assignedClasses||[]).includes(t.id))}),s},[c,E]),S=async()=>{if(u.trim())try{await m.add({name:u.trim(),year:new Date().getFullYear(),schoolId:x}),g(""),p(!1)}catch(s){console.error("æ–°å¢ç­ç´šå¤±æ•—:",s)}},K=async s=>{if(j.trim())try{await m.update(s,{name:j.trim()}),f(null),N("")}catch(t){console.error("æ›´æ–°ç­ç´šå¤±æ•—:",t)}},X=async s=>{if(window.confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ç­ç´šå—ï¼Ÿ"))try{await m.delete(s),i===s&&D(null)}catch(t){console.error("åˆªé™¤ç­ç´šå¤±æ•—:",t)}},k=s=>{D(s),b()},Y=s=>{T(t=>t===s?null:s)},q=s=>{y&&y(s),b()},z=s=>{if(s.customSchoolName)return s.customSchoolCity?`${s.customSchoolCity} ${s.customSchoolName}`:s.customSchoolName;if(s.schoolId){const t=L.find(d=>d.id===s.schoolId);if(t)return t.city?`${t.city} ${t.name}`:t.name}return s.schoolName||""};return r?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-2 sm:p-4",children:e.jsxs("div",{className:"card-pop w-full max-w-lg max-h-[85vh] flex flex-col animate-in bg-[#FFF9E6]",children:[e.jsxs("div",{className:"p-3 sm:p-5 bg-[#A29BFE] border-b-3 border-[#2D3436] flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-white flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(Q,{size:24}),"ç­ç´šç®¡ç†"]}),e.jsx("button",{onClick:b,className:"btn-pop p-2 bg-white text-[#2D3436]",children:e.jsx(v,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 sm:p-4 mobile-scroll-hide",children:P?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"text-4xl animate-bounce",children:"ğŸ«"})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>k(null),className:`w-full p-3 sm:p-4 border-2 border-[#2D3436] rounded-lg flex items-center justify-between transition-all shadow-[3px_3px_0_#2D3436]
                  ${i?"bg-white hover:bg-[#FECA57]/20":"bg-[#1DD1A1] text-white"}`,children:[e.jsxs("span",{className:"font-bold flex items-center gap-2 text-sm sm:text-base",children:[e.jsx("span",{className:"text-lg",children:"ğŸ“š"})," å…¨éƒ¨å­¸ç”Ÿ"]}),!i&&e.jsx(h,{size:20})]}),w.map(s=>{const t=I[s.id]||[],d=R===s.id;return e.jsx("div",{className:`border-2 border-[#2D3436] rounded-lg shadow-[3px_3px_0_#2D3436] transition-all overflow-hidden
                                            ${i===s.id?"bg-[#54A0FF] text-white":"bg-white"}`,children:M===s.id?e.jsxs("div",{className:"p-3 sm:p-4 flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsx("input",{type:"text",value:j,onChange:n=>N(n.target.value),className:"flex-1 p-2 border-2 border-[#2D3436] rounded-lg text-[#2D3436] font-bold text-sm",autoFocus:!0}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>K(s.id),className:"btn-pop p-2 bg-[#1DD1A1] text-white",children:e.jsx(h,{size:16})}),e.jsx("button",{onClick:()=>f(null),className:"btn-pop p-2 bg-[#636E72] text-white",children:e.jsx(v,{size:16})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"p-3 sm:p-4 flex items-center justify-between gap-2",children:[e.jsxs("button",{onClick:()=>k(s.id),className:"flex-1 text-left font-bold flex items-center gap-2 text-sm sm:text-base min-w-0",children:[e.jsx("span",{className:"text-lg shrink-0",children:"ğŸ«"}),e.jsx("span",{className:"truncate",children:s.name}),i===s.id&&e.jsx(h,{size:18,className:"shrink-0"})]}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0",children:[a&&t.length>0&&e.jsxs("button",{onClick:n=>{n.stopPropagation(),Y(s.id)},className:`p-1.5 sm:p-2 rounded transition-colors flex items-center gap-1 text-xs
                                                                    ${i===s.id?"hover:bg-white/20":"hover:bg-[#A29BFE]/20 text-[#A29BFE]"}`,title:"æŸ¥çœ‹ç¶“ç‡Ÿè€…",children:[e.jsx(C,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:t.length}),d?e.jsx(Z,{size:14}):e.jsx(U,{size:14})]}),a&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{f(s.id),N(s.name)},className:`p-1.5 sm:p-2 transition-colors ${i===s.id?"hover:bg-white/20":"hover:text-[#54A0FF]"}`,children:e.jsx(ee,{size:16})}),e.jsx("button",{onClick:()=>X(s.id),className:`p-1.5 sm:p-2 transition-colors ${i===s.id?"hover:bg-white/20":"hover:text-[#FF6B6B]"}`,children:e.jsx(V,{size:16})})]})]})]}),a&&d&&t.length>0&&e.jsxs("div",{className:`border-t-2 border-dashed p-2 sm:p-3 space-y-2
                                                        ${i===s.id?"border-white/30 bg-white/10":"border-[#2D3436]/20 bg-[#F8F4E8]"}`,children:[e.jsxs("p",{className:`text-xs font-bold flex items-center gap-1 mb-2
                                                            ${i===s.id?"text-white/80":"text-[#636E72]"}`,children:[e.jsx(C,{size:12}),"ç¶“ç‡Ÿè€… (",t.length,")"]}),t.map(n=>e.jsxs("div",{className:`flex flex-col sm:flex-row sm:items-center gap-2 p-2 rounded-lg border transition-all
                                                                    ${i===s.id?"bg-white/20 border-white/30":"bg-white border-[#2D3436]/20 hover:border-[#54A0FF]"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[n.photoURL?e.jsx("img",{src:n.photoURL,alt:"",className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full border border-[#2D3436] shrink-0"}):e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 bg-[#FECA57] rounded-full border border-[#2D3436] flex items-center justify-center text-xs shrink-0",children:"ğŸ‘¤"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("p",{className:`font-bold text-xs sm:text-sm truncate
                                                                            ${i===s.id?"text-white":"text-[#2D3436]"}`,children:n.displayName}),z(n)&&e.jsxs("p",{className:`text-[10px] sm:text-xs truncate
                                                                                ${i===s.id?"text-white/70":"text-[#636E72]"}`,children:["ğŸ« ",z(n)]})]})]}),e.jsxs("button",{onClick:()=>q(n),className:`flex items-center justify-center gap-1 px-2 py-1.5 rounded text-xs font-bold transition-all self-end sm:self-auto
                                                                        ${i===s.id?"bg-white text-[#54A0FF] hover:bg-white/90":"bg-[#54A0FF] text-white hover:bg-[#54A0FF]/80"}`,children:[e.jsx(O,{size:12}),e.jsx("span",{className:"hidden sm:inline",children:"æŸ¥çœ‹å­¸ç”Ÿ"}),e.jsx("span",{className:"sm:hidden",children:"æŸ¥çœ‹"})]})]},n.id))]}),a&&d&&t.length===0&&e.jsx("div",{className:`border-t-2 border-dashed p-3 text-center text-xs
                                                        ${i===s.id?"border-white/30 text-white/70":"border-[#2D3436]/20 text-[#636E72]"}`,children:"å°šç„¡è€å¸«è¢«æŒ‡æ´¾åˆ°æ­¤ç­ç´š"})]})},s.id)}),a&&A?e.jsx("div",{className:"p-3 sm:p-4 border-2 border-dashed border-[#1DD1A1] rounded-lg bg-[#1DD1A1]/10",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[e.jsx("input",{type:"text",value:u,onChange:s=>g(s.target.value),placeholder:"è¼¸å…¥ç­ç´šåç¨±...",className:"flex-1 p-2 border-2 border-[#2D3436] rounded-lg font-bold text-sm",autoFocus:!0,onKeyDown:s=>s.key==="Enter"&&S()}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:S,className:"btn-pop p-2 bg-[#1DD1A1] text-white",children:e.jsx(h,{size:16})}),e.jsx("button",{onClick:()=>{p(!1),g("")},className:"btn-pop p-2 bg-[#636E72] text-white",children:e.jsx(v,{size:16})})]})]})}):a&&e.jsxs("button",{onClick:()=>p(!0),className:"w-full p-3 sm:p-4 border-2 border-dashed border-[#1DD1A1] rounded-lg text-[#1DD1A1] font-bold flex items-center justify-center gap-2 hover:bg-[#1DD1A1]/10 transition-colors text-sm sm:text-base",children:[e.jsx(W,{size:20}),"æ–°å¢ç­ç´š"]}),w.length===0&&!A&&e.jsxs("div",{className:"text-center py-8 text-[#636E72]",children:[e.jsx("div",{className:"text-4xl mb-3",children:"ğŸ«"}),e.jsx("p",{className:"font-bold",children:a?"é‚„æ²’æœ‰ç­ç´š":"æ‚¨å°šæœªè¢«æŒ‡æ´¾ä»»ä½•ç­ç´š"}),e.jsx("p",{className:"text-sm mt-1",children:a?"é»æ“Šä¸Šæ–¹ã€Œæ–°å¢ç­ç´šã€é–‹å§‹ç®¡ç†":"è«‹è¯ç¹«ç®¡ç†å“¡ç‚ºæ‚¨æŒ‡æ´¾ç­ç´š"})]})]})}),e.jsxs("div",{className:"p-3 sm:p-4 bg-[#E8DCC8] border-t-2 border-dashed border-[#2D3436]/20 text-xs text-[#636E72] text-center",children:["å…± ",w.length," å€‹ç­ç´š ",a&&"| é»æ“Šå±•é–‹æŸ¥çœ‹ç¶“ç‡Ÿè€…"]})]})}):null};export{ae as default};
