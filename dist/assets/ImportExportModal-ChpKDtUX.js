import{k as L,r as n,j as e,F as q,X as R,D as w,l as h,L as _,a as P,p as U,m as V,n as W,o as X}from"./index-Bn5A4t6f.js";import{F as G}from"./file-down-C_6yzQfH.js";import{C as H}from"./check-DoRn9BXH.js";const Y=({isOpen:E,onClose:f,students:d,onImport:k,currentClassName:g="å­¸ç”Ÿè³‡æ–™"})=>{const{toast:c}=L(),j=n.useRef(null),[b,D]=n.useState("export"),[B,N]=n.useState(!1),[v,A]=n.useState({includeNumber:!0,includeName:!0,includeTraits:!0,includeManualTraits:!0,includeComment:!0}),[i,m]=n.useState(null),[t,p]=n.useState({}),[x,F]=n.useState("append"),[y,u]=n.useState(!1),C=async s=>{if(!s)return;if(!["application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.ms-excel","text/csv"].includes(s.type)&&!s.name.match(/\.(xlsx|xls|csv)$/i)){c.error("è«‹é¸æ“‡ Excel æˆ– CSV æª”æ¡ˆ");return}N(!0);try{const{headers:l,rows:r,sheetName:o}=await U(s),O=V(l);m({headers:l,rows:r,sheetName:o,fileName:s.name}),p(O),c.success(`å·²è®€å– ${r.length} ç­†è³‡æ–™`)}catch(l){c.error(l.message),m(null)}N(!1)},S=n.useCallback(s=>{s.preventDefault(),u(!0)},[]),T=n.useCallback(s=>{s.preventDefault(),u(!1)},[]),$=n.useCallback(s=>{s.preventDefault(),u(!1);const a=s.dataTransfer.files[0];a&&C(a)},[]),z=()=>{if(!i||t.name<0){c.error("è«‹è‡³å°‘æŒ‡å®šå§“åæ¬„ä½");return}const s=i.rows.map((a,l)=>{const r=a[t.name]||"";return r?{id:`import_${Date.now()}_${l}`,number:t.number>=0?a[t.number]:l+1,name:String(r).trim(),traits:"",selectedTags:t.traits>=0?String(a[t.traits]||"").split(/[ã€,ï¼Œ]/).filter(Boolean):[],manualTraits:"",comment:t.comment>=0?String(a[t.comment]||""):""}:null}).filter(Boolean);if(s.length===0){c.error("æ²’æœ‰æœ‰æ•ˆçš„å­¸ç”Ÿè³‡æ–™");return}k(s,x),c.success(`å·²åŒ¯å…¥ ${s.length} ä½å­¸ç”Ÿ`),m(null),p({}),f()},M=()=>{if(d.length===0){c.warning("æ²’æœ‰å­¸ç”Ÿè³‡æ–™å¯åŒ¯å‡º");return}const s=`${g}_${new Date().toLocaleDateString("zh-TW").replace(/\//g,"-")}`;W(d,s,v),c.success(`å·²åŒ¯å‡º ${d.length} ä½å­¸ç”Ÿè³‡æ–™`)},I=()=>{X(),c.info("ç¯„æœ¬ä¸‹è¼‰å®Œæˆ")};return E?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-2 sm:p-4",children:e.jsxs("div",{className:"card-pop w-full max-w-2xl max-h-[90vh] flex flex-col animate-in bg-[#FFF9E6]",children:[e.jsxs("div",{className:"p-3 sm:p-5 bg-[#54A0FF] border-b-3 border-[#2D3436] flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-white flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(q,{size:24}),"Excel åŒ¯å…¥/åŒ¯å‡º"]}),e.jsx("button",{onClick:f,className:"btn-pop p-2 bg-white text-[#2D3436]",children:e.jsx(R,{size:20})})]}),e.jsxs("div",{className:"flex border-b-2 border-[#2D3436]",children:[e.jsxs("button",{onClick:()=>D("export"),className:`flex-1 py-3 px-4 font-bold flex items-center justify-center gap-2 transition-colors
                            ${b==="export"?"bg-[#1DD1A1] text-white":"bg-[#E8DCC8] text-[#636E72] hover:bg-[#FECA57]/30"}`,children:[e.jsx(w,{size:18}),"åŒ¯å‡º"]}),e.jsxs("button",{onClick:()=>D("import"),className:`flex-1 py-3 px-4 font-bold flex items-center justify-center gap-2 transition-colors
                            ${b==="import"?"bg-[#FF6B9D] text-white":"bg-[#E8DCC8] text-[#636E72] hover:bg-[#FECA57]/30"}`,children:[e.jsx(h,{size:18}),"åŒ¯å…¥"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6",children:b==="export"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white border-2 border-[#2D3436] rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-[#2D3436] mb-3",children:"é¸æ“‡åŒ¯å‡ºæ¬„ä½"}),e.jsx("div",{className:"space-y-2",children:[{key:"includeNumber",label:"åº§è™Ÿ"},{key:"includeName",label:"å§“å"},{key:"includeTraits",label:"ç‰¹è³ªæ¨™ç±¤"},{key:"includeManualTraits",label:"è‡ªè¨‚ç‰¹è³ª"},{key:"includeComment",label:"è©•èª"}].map(({key:s,label:a})=>e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:v[s],onChange:l=>A(r=>({...r,[s]:l.target.checked})),className:"w-5 h-5 rounded border-2 border-[#2D3436] accent-[#1DD1A1]"}),e.jsx("span",{className:"font-medium text-[#2D3436]",children:a})]},s))})]}),e.jsxs("div",{className:"bg-[#1DD1A1]/20 border-2 border-[#1DD1A1] rounded-lg p-4 text-sm text-[#2D3436]",children:[e.jsx("p",{className:"font-bold mb-1",children:"ğŸ“Š åŒ¯å‡ºè³‡è¨Š"}),e.jsxs("p",{children:["å°‡åŒ¯å‡º ",e.jsx("strong",{children:d.length})," ä½å­¸ç”Ÿçš„è³‡æ–™"]}),e.jsxs("p",{children:["ç­ç´šï¼š",e.jsx("strong",{children:g})]})]}),e.jsxs("button",{onClick:M,disabled:d.length===0,className:"btn-pop w-full py-4 bg-[#1DD1A1] text-white font-bold text-lg flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(w,{size:20}),"åŒ¯å‡º Excel"]})]}):e.jsx("div",{className:"space-y-4",children:i?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-[#54A0FF]/20 border-2 border-[#54A0FF] rounded-lg p-3 text-sm",children:[e.jsxs("p",{className:"font-bold text-[#2D3436]",children:["ğŸ“„ ",i.fileName]}),e.jsxs("p",{className:"text-[#636E72]",children:["å…± ",i.rows.length," ç­†è³‡æ–™"]})]}),e.jsxs("div",{className:"bg-white border-2 border-[#2D3436] rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-[#2D3436] mb-3",children:"æ¬„ä½å°æ‡‰"}),e.jsx("div",{className:"space-y-3",children:[{key:"number",label:"åº§è™Ÿ",required:!1},{key:"name",label:"å§“å",required:!0},{key:"traits",label:"ç‰¹è³ª",required:!1},{key:"comment",label:"è©•èª",required:!1}].map(({key:s,label:a,required:l})=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"w-20 font-medium text-[#2D3436]",children:[a,l&&e.jsx("span",{className:"text-[#FF6B6B]",children:"*"})]}),e.jsxs("select",{value:t[s]??-1,onChange:r=>p(o=>({...o,[s]:parseInt(r.target.value)})),className:"flex-1 p-2 border-2 border-[#2D3436] rounded-lg font-medium",children:[e.jsx("option",{value:-1,children:"-- ä¸åŒ¯å…¥ --"}),i.headers.map((r,o)=>e.jsx("option",{value:o,children:r||`æ¬„ä½ ${o+1}`},o))]}),t[s]>=0&&e.jsx(H,{size:18,className:"text-[#1DD1A1]"})]},s))})]}),e.jsxs("div",{className:"bg-white border-2 border-[#2D3436] rounded-lg p-4",children:[e.jsx("h4",{className:"font-bold text-[#2D3436] mb-3",children:"åŒ¯å…¥æ¨¡å¼"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{type:"radio",name:"importMode",value:"append",checked:x==="append",onChange:s=>F(s.target.value),className:"sr-only"}),e.jsxs("div",{className:`p-3 border-2 rounded-lg cursor-pointer transition-all
                                                    ${x==="append"?"border-[#1DD1A1] bg-[#1DD1A1]/20":"border-[#636E72]"}`,children:[e.jsx("p",{className:"font-bold text-[#2D3436]",children:"æ–°å¢"}),e.jsx("p",{className:"text-xs text-[#636E72]",children:"ä¿ç•™ç¾æœ‰å­¸ç”Ÿ"})]})]}),e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{type:"radio",name:"importMode",value:"replace",checked:x==="replace",onChange:s=>F(s.target.value),className:"sr-only"}),e.jsxs("div",{className:`p-3 border-2 rounded-lg cursor-pointer transition-all
                                                    ${x==="replace"?"border-[#FF6B6B] bg-[#FF6B6B]/20":"border-[#636E72]"}`,children:[e.jsx("p",{className:"font-bold text-[#2D3436]",children:"å–ä»£"}),e.jsx("p",{className:"text-xs text-[#636E72]",children:"æ¸…é™¤ç¾æœ‰å­¸ç”Ÿ"})]})]})]})]}),t.name<0&&e.jsxs("div",{className:"bg-[#FF6B6B]/20 border-2 border-[#FF6B6B] rounded-lg p-3 flex items-center gap-2 text-sm text-[#FF6B6B]",children:[e.jsx(P,{size:18}),"è«‹è‡³å°‘æŒ‡å®šã€Œå§“åã€æ¬„ä½"]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{m(null),p({})},className:"btn-pop flex-1 py-3 bg-[#636E72] text-white font-bold",children:"é‡æ–°é¸æ“‡"}),e.jsxs("button",{onClick:z,disabled:t.name<0,className:"btn-pop flex-1 py-3 bg-[#FF6B9D] text-white font-bold flex items-center justify-center gap-2 disabled:opacity-50",children:[e.jsx(h,{size:18}),"ç¢ºèªåŒ¯å…¥"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{onDragOver:S,onDragLeave:T,onDrop:$,onClick:()=>{var s;return(s=j.current)==null?void 0:s.click()},className:`border-3 border-dashed rounded-lg p-8 text-center cursor-pointer transition-all
                                            ${y?"border-[#FF6B9D] bg-[#FF6B9D]/10":"border-[#636E72] hover:border-[#FF6B9D] hover:bg-[#FECA57]/10"}`,children:[e.jsx("input",{ref:j,type:"file",accept:".xlsx,.xls,.csv",onChange:s=>C(s.target.files[0]),className:"hidden"}),B?e.jsx(_,{size:48,className:"mx-auto text-[#FF6B9D] animate-spin"}):e.jsx(h,{size:48,className:"mx-auto text-[#636E72] mb-3"}),e.jsx("p",{className:"font-bold text-[#2D3436] mb-1",children:y?"æ”¾é–‹ä»¥ä¸Šå‚³æª”æ¡ˆ":"é»æ“Šæˆ–æ‹–æ‹½ä¸Šå‚³ Excel æª”æ¡ˆ"}),e.jsx("p",{className:"text-sm text-[#636E72]",children:"æ”¯æ´ .xlsxã€.xlsã€.csv æ ¼å¼"})]}),e.jsxs("button",{onClick:I,className:"btn-pop w-full py-3 bg-[#54A0FF] text-white font-bold flex items-center justify-center gap-2",children:[e.jsx(G,{size:18}),"ä¸‹è¼‰åŒ¯å…¥ç¯„æœ¬"]})]})})})]})}):null};export{Y as default};
