import{c as h,r,s as o,j as e,X as w,L as u,C as F,a as v}from"./index-IsHpGelR.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=h("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const S=h("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=h("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]),B=({isOpen:d,onClose:A,currentUser:f})=>{const[s,x]=r.useState(""),[b,g]=r.useState(!1),[l,n]=r.useState(!1),[m,a]=r.useState(null),[p,i]=r.useState(""),[N,y]=r.useState(!0);r.useEffect(()=>{if(!d||!f)return;y(!0);const t=o.subscribe(c=>{const j=(c==null?void 0:c.apiKey)||"";i(j),x(j),y(!1)});return()=>t()},[d,f]);const K=async()=>{if(s.trim()){n(!0);try{await o.save({apiKey:s.trim()}),i(s.trim()),a(null),localStorage.setItem("gemini_api_key",s.trim())}catch(t){console.error("å„²å­˜ API Key å¤±æ•—:",t),alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}n(!1)}},k=async()=>{if(window.confirm("ç¢ºå®šè¦æ¸…é™¤ API Key å—ï¼Ÿ")){n(!0);try{await o.save({apiKey:""}),x(""),i(""),a(null),localStorage.removeItem("gemini_api_key")}catch(t){console.error("æ¸…é™¤ API Key å¤±æ•—:",t)}n(!1)}},I=async()=>{if(!s.trim()){a("error");return}g(!0),a(null);try{const t=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${s.trim()}`;(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:"è«‹å›è¦†ã€Œé€£ç·šæˆåŠŸã€å››å€‹å­—"}]}]})})).ok?(a("success"),await o.save({apiKey:s.trim()}),i(s.trim()),localStorage.setItem("gemini_api_key",s.trim())):a("error")}catch(t){console.error("API æ¸¬è©¦å¤±æ•—:",t),a("error")}g(!1)},D=t=>!t||t.length<10?t:t.substring(0,6)+"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+t.substring(t.length-4);return d?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-2 sm:p-4",children:e.jsxs("div",{className:"card-pop w-full max-w-lg flex flex-col animate-in bg-[#FFF9E6]",children:[e.jsxs("div",{className:"p-3 sm:p-5 bg-[#FF9F43] border-b-3 border-[#2D3436] flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-white flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(P,{size:24}),"API Key è¨­å®š"]}),e.jsx("button",{onClick:A,className:"btn-pop p-2 bg-white text-[#2D3436]",children:e.jsx(w,{size:20})})]}),e.jsx("div",{className:"p-4 sm:p-6 space-y-4",children:N?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(u,{size:32,className:"animate-spin text-[#FF9F43]"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-[#54A0FF]/20 border-2 border-[#54A0FF] rounded-lg p-3 text-sm text-[#2D3436]",children:[e.jsx("p",{className:"font-bold mb-1",children:"ğŸ’¡ å¦‚ä½•å–å¾— API Keyï¼Ÿ"}),e.jsx("p",{className:"text-[#636E72]",children:"å‰å¾€ Google AI Studio ç”³è«‹å…è²»çš„ Gemini API Key"}),e.jsxs("a",{href:"https://aistudio.google.com/apikey",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-[#54A0FF] hover:underline font-bold mt-2",children:[e.jsx(S,{size:14}),"å‰å¾€ç”³è«‹ API Key"]})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-bold text-[#2D3436]",children:"ç›®å‰ç‹€æ…‹ï¼š"}),p?e.jsxs("span",{className:"flex items-center gap-1 text-[#1DD1A1] font-bold",children:[e.jsx(F,{size:16}),"å·²è¨­å®š (",D(p),")"]}):e.jsxs("span",{className:"flex items-center gap-1 text-[#FF6B6B] font-bold",children:[e.jsx(v,{size:16}),"å°šæœªè¨­å®š"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-[#2D3436] mb-2",children:"ğŸ”‘ Gemini API Key"}),e.jsx("input",{type:"password",value:s,onChange:t=>{x(t.target.value),a(null)},placeholder:"è¼¸å…¥æ‚¨çš„ API Key...",className:"w-full p-3 border-3 border-[#2D3436] rounded-lg text-[#2D3436] font-medium placeholder:text-[#636E72]/50 focus:border-[#FF9F43] outline-none"})]}),m&&e.jsx("div",{className:`p-3 rounded-lg border-2 flex items-center gap-2 text-sm font-bold
                                  ${m==="success"?"bg-[#1DD1A1]/20 border-[#1DD1A1] text-[#1DD1A1]":"bg-[#FF6B6B]/20 border-[#FF6B6B] text-[#FF6B6B]"}`,children:m==="success"?e.jsxs(e.Fragment,{children:[e.jsx(F,{size:18}),"é€£ç·šæ¸¬è©¦æˆåŠŸï¼API Key å·²è‡ªå‹•å„²å­˜ âœ¨"]}):e.jsxs(e.Fragment,{children:[e.jsx(v,{size:18}),"é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢º"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[e.jsx("button",{onClick:I,disabled:!s.trim()||b||l,className:"btn-pop flex-1 py-3 bg-[#54A0FF] text-white font-bold flex items-center justify-center gap-2 disabled:opacity-50",children:b?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:18,className:"animate-spin"}),"æ¸¬è©¦ä¸­..."]}):e.jsx(e.Fragment,{children:"ğŸ§ª æ¸¬è©¦é€£ç·š"})}),e.jsx("button",{onClick:K,disabled:!s.trim()||l,className:"btn-pop flex-1 py-3 bg-[#1DD1A1] text-white font-bold disabled:opacity-50 flex items-center justify-center gap-2",children:l?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:18,className:"animate-spin"}),"å„²å­˜ä¸­..."]}):e.jsx(e.Fragment,{children:"ğŸ’¾ å„²å­˜"})})]}),p&&e.jsx("button",{onClick:k,disabled:l,className:"w-full text-center text-sm text-[#FF6B6B] hover:underline font-bold disabled:opacity-50",children:"ğŸ—‘ï¸ æ¸…é™¤å·²å„²å­˜çš„ API Key"})]})}),e.jsxs("div",{className:"p-3 sm:p-4 bg-[#E8DCC8] border-t-2 border-dashed border-[#2D3436]/20 text-xs text-[#636E72] text-center flex items-center justify-center gap-1",children:[e.jsx(C,{size:14}),"API Key å®‰å…¨å„²å­˜æ–¼æ‚¨çš„å€‹äººå¸³è™Ÿï¼Œä¸æœƒèˆ‡ä»–äººå…±ç”¨"]})]})}):null};export{B as default};
