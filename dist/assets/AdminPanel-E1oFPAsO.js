import{c as ae,r as n,u as K,e as U,f as te,b as P,m as be,U as o,j as e,n as Be,X as ue,L as V,o as fe,p as Le,i as _e,B as $e,h as R,g as ve,l as Ge,q as He,T as Me}from"./index-CBp3GSCB.js";import{E as ye}from"./eye-yGmyv5bi.js";import{F as ge}from"./file-text-B2FDNG5L.js";import{C as Ve,U as We}from"./users-4Vnw4V3a.js";import{K as Oe,G as Qe}from"./key-RDmEU-JP.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xe=ae("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Je=ae("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=ae("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]),as=({isOpen:a,onClose:D,currentUser:c})=>{var he,pe;const[m,b]=n.useState([]),[h,u]=n.useState([]),[f,p]=n.useState([]),[E,C]=n.useState(!0),[t,z]=n.useState(null),[w,v]=n.useState([]),[g,S]=n.useState(null),[A,q]=n.useState(!1),[i,we]=n.useState(null),[B,W]=n.useState(""),[L,_]=n.useState(!1),[ne,de]=n.useState(null),[F,re]=n.useState(null),[O,Q]=n.useState([]),[Ae,ie]=n.useState(!1),[x,k]=n.useState(null),[X,ce]=n.useState(!1);n.useEffect(()=>{if(!a)return;C(!0);const s=K.subscribeAll(r=>{b(r),C(!1)}),l=U.subscribe(r=>{u(r)}),d=te.subscribe(r=>{p(r)}),j=P.subscribe(r=>{we(r),r!=null&&r.sharedApiKey&&W(r.sharedApiKey)});return()=>{s(),l(),d(),j()}},[a]);const oe=s=>{var l,d;if(z(s),S(s.schoolId||s.requestedSchoolId||null),((l=s.assignedClasses)==null?void 0:l.length)>0)v(s.assignedClasses);else if(((d=s.requestedClasses)==null?void 0:d.length)>0){const j=s.requestedClasses.map(r=>{var y;return(y=h.find(I=>I.name===r))==null?void 0:y.id}).filter(Boolean);v(j)}else v([])},De=s=>{v(l=>l.includes(s)?l.filter(d=>d!==s):[...l,s])},Se=async()=>{var j;if(!t)return;let s=null,l=null;t.requestedSchoolId?s=t.requestedSchoolId:t.requestedSchoolName?l={name:t.requestedSchoolName,city:t.requestedSchoolCity||""}:g&&(s=g);let d=w;if(w.length===0&&((j=t.requestedClasses)==null?void 0:j.length)>0){const r=[];for(const y of t.requestedClasses){const I=h.find(N=>N.name===y);if(I)r.push(I.id);else try{const N=t.requestedSchoolName?`${t.requestedSchoolCity||""}_${t.requestedSchoolName}`.trim():null,T=await U.add({name:y,schoolId:N});T&&r.push(T)}catch(N){console.error("è‡ªå‹•å‰µå»ºç­ç´šå¤±æ•—:",y,N)}}d=r}await K.approve(t.id,d,s,l),z(null),v([]),S(null)},Fe=async()=>{var j;if(!t)return;let s=g,l=null;!g&&t.requestedSchoolName?l={name:t.requestedSchoolName,city:t.requestedSchoolCity}:!g&&t.requestedSchoolId&&(s=t.requestedSchoolId);let d=w;if(w.length===0&&((j=t.requestedClasses)==null?void 0:j.length)>0){const r=[];for(const y of t.requestedClasses){const I=h.find(N=>N.name===y);if(I)r.push(I.id);else try{const N=l?`${l.city||""}_${l.name}`.trim():t.customSchoolName?`${t.customSchoolCity||""}_${t.customSchoolName}`.trim():null,T=await U.add({name:y,schoolId:N});T&&r.push(T)}catch(N){console.error("è‡ªå‹•å‰µå»ºç­ç´šå¤±æ•—:",y,N)}}d=r}await K.updateAssignedClasses(t.id,d,s,l),z(null),v([]),S(null)},J=async s=>{window.confirm("ç¢ºå®šè¦æ‹’çµ•/æ’¤éŠ·æ­¤ä½¿ç”¨è€…çš„æ¬Šé™å—ï¼Ÿå°‡é‡ç½®ç‚ºå¾…å¡«è³‡æ–™ç‹€æ…‹ã€‚")&&await K.reject(s)},Y=async s=>{if(console.log("[AdminPanel] å˜—è©¦åˆªé™¤ä½¿ç”¨è€…:",s),!window.confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ä½¿ç”¨è€…å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")){console.log("[AdminPanel] ä½¿ç”¨è€…å–æ¶ˆåˆªé™¤");return}try{console.log("[AdminPanel] é–‹å§‹åˆªé™¤...");const l=await K.delete(s);l.success?console.log("[AdminPanel] åˆªé™¤æˆåŠŸ"):(console.error("[AdminPanel] åˆªé™¤å¤±æ•—:",l.error),alert("åˆªé™¤å¤±æ•—: "+(l.error||"æœªçŸ¥éŒ¯èª¤")))}catch(l){console.error("[AdminPanel] åˆªé™¤éŒ¯èª¤:",l),alert("åˆªé™¤å¤±æ•—: "+l.message)}},$=s=>{switch(s){case o.ADMIN:return e.jsx("span",{className:"px-2 py-0.5 bg-[#FF6B9D] text-white text-xs font-bold rounded-full",children:"ç®¡ç†å“¡"});case o.TEACHER:return e.jsx("span",{className:"px-2 py-0.5 bg-[#1DD1A1] text-white text-xs font-bold rounded-full",children:"æ•™å¸«"});case o.PENDING_REVIEW:return e.jsx("span",{className:"px-2 py-0.5 bg-[#FECA57] text-[#2D3436] text-xs font-bold rounded-full",children:"å¾…å¯©æ ¸"});case o.PENDING_INFO:return e.jsx("span",{className:"px-2 py-0.5 bg-[#A29BFE] text-white text-xs font-bold rounded-full",children:"å¾…å¡«è³‡æ–™"});default:return e.jsx("span",{className:"px-2 py-0.5 bg-[#FECA57] text-[#2D3436] text-xs font-bold rounded-full",children:"å¾…å¯©æ ¸"})}},Z=s=>s!=null&&s.toDate?s.toDate().toLocaleDateString("zh-TW"):"-",Ee=s=>{var l;return((l=f.find(d=>d.id===s))==null?void 0:l.name)||"æœªçŸ¥å­¸æ ¡"},Ce=async()=>{if(B.trim()){_(!0);try{await P.saveSharedApiKey(B.trim(),c.uid)}catch(s){console.error("å„²å­˜å…±äº« API Key å¤±æ•—:",s),alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}_(!1)}},ke=async()=>{if(window.confirm("ç¢ºå®šè¦æ¸…é™¤å…±äº« API Key å—ï¼Ÿæ‰€æœ‰å·²æˆæ¬Šç”¨æˆ¶å°‡ç„¡æ³•ä½¿ç”¨ã€‚")){_(!0);try{await P.clearSharedApiKey(c.uid),W("")}catch(s){console.error("æ¸…é™¤å…±äº« API Key å¤±æ•—:",s)}_(!1)}},Ie=async s=>{de(s);try{((i==null?void 0:i.authorizedUsers)||[]).includes(s)?await P.revokeAccess(s,c.uid):await P.grantAccess(s,c.uid)}catch(l){console.error("åˆ‡æ›æˆæ¬Šå¤±æ•—:",l)}de(null)},ze=s=>!s||s.length<10?s:s.substring(0,6)+"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+s.substring(s.length-4),G=s=>((i==null?void 0:i.authorizedUsers)||[]).includes(s),qe=n.useCallback(s=>{re(s),ie(!0),Q([]),k(null);const l=be.subscribeByUserId(s.id,d=>{const j=d.map(r=>({...r,id:r.id,selectedTags:r.selectedTags||[],manualTraits:r.manualTraits||"",comment:r.comment||""}));Q(j),ie(!1)});window._adminStudentUnsubscribe=l},[]),Te=n.useCallback(()=>{window._adminStudentUnsubscribe&&(window._adminStudentUnsubscribe(),window._adminStudentUnsubscribe=null),re(null),Q([]),k(null)},[]),Ke=n.useCallback(s=>{k({...s})},[]),Ue=n.useCallback(()=>{k(null)},[]),Pe=n.useCallback(async()=>{if(!(!x||!F)){ce(!0);try{await be.updateByUserId(F.id,x.id,{name:x.name,selectedTags:x.selectedTags,manualTraits:x.manualTraits,comment:x.comment}),k(null)}catch(s){console.error("å„²å­˜å­¸ç”Ÿè³‡æ–™å¤±æ•—:",s),alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}ce(!1)}},[x,F]),ee=n.useCallback((s,l)=>{k(d=>d?{...d,[s]:l}:null)},[]),Re=n.useCallback(s=>{k(l=>l?{...l,selectedTags:l.selectedTags.filter(d=>d!==s)}:null)},[]),xe=((i==null?void 0:i.authorizedUsers)||[]).length,se=m.filter(s=>s.role===o.TEACHER),H=m.filter(s=>s.role===o.PENDING_REVIEW||s.role===o.PENDING),M=m.filter(s=>s.role===o.PENDING_INFO),me=m.filter(s=>s.role===o.TEACHER||s.role===o.ADMIN);return a?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-2 sm:p-4",children:e.jsxs("div",{className:"card-pop w-full max-w-4xl max-h-[90vh] flex flex-col animate-in bg-[#FFF9E6]",children:[e.jsxs("div",{className:"p-3 sm:p-5 bg-[#FF6B9D] border-b-3 border-[#2D3436] flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-white flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(Be,{size:24}),"ç®¡ç†å“¡é¢æ¿"]}),e.jsx("button",{onClick:D,className:"btn-pop p-2 bg-white text-[#2D3436]",children:e.jsx(ue,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 sm:p-4 mobile-scroll-hide",children:E?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"text-4xl animate-bounce",children:"ğŸ‘¥"})}):F?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 p-4 bg-gradient-to-r from-[#54A0FF]/10 to-[#1DD1A1]/10 border-2 border-[#54A0FF] rounded-lg",children:[e.jsxs("button",{onClick:Te,className:"btn-pop p-2 bg-white text-[#54A0FF] flex items-center gap-1",children:[e.jsx(Xe,{size:16}),"è¿”å›"]}),e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[F.photoURL?e.jsx("img",{src:F.photoURL,alt:"",className:"w-10 h-10 rounded-full border-2 border-[#54A0FF]"}):e.jsx("div",{className:"w-10 h-10 bg-[#54A0FF]/20 rounded-full border-2 border-[#54A0FF] flex items-center justify-center",children:"ğŸ‘¤"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-bold text-[#2D3436] flex items-center gap-2",children:[e.jsx(ye,{size:16,className:"text-[#54A0FF]"}),"æ­£åœ¨æŸ¥çœ‹ï¼š",F.displayName]}),e.jsx("div",{className:"text-xs text-[#636E72]",children:F.email})]}),e.jsxs("div",{className:"text-sm font-bold text-[#54A0FF]",children:["å…± ",O.length," ä½å­¸ç”Ÿ"]})]})]}),Ae?e.jsx("div",{className:"flex items-center justify-center py-10",children:e.jsx(V,{size:32,className:"animate-spin text-[#54A0FF]"})}):O.length===0?e.jsxs("div",{className:"text-center py-10 text-[#636E72]",children:[e.jsx("div",{className:"text-4xl mb-2",children:"ğŸ“­"}),e.jsx("p",{className:"font-medium",children:"æ­¤ç”¨æˆ¶å°šç„¡å­¸ç”Ÿè³‡æ–™"})]}):e.jsx("div",{className:"space-y-3",children:O.map(s=>e.jsx("div",{className:`bg-white border-2 rounded-lg overflow-hidden ${(x==null?void 0:x.id)===s.id?"border-[#1DD1A1]":"border-[#2D3436]"}`,children:(x==null?void 0:x.id)===s.id?e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"font-bold text-[#1DD1A1] flex items-center gap-2",children:[e.jsx(fe,{size:16}),"ç·¨è¼¯å­¸ç”Ÿè³‡æ–™"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:Ue,disabled:X,className:"btn-pop px-3 py-1.5 bg-[#636E72] text-white text-xs font-bold",children:"å–æ¶ˆ"}),e.jsxs("button",{onClick:Pe,disabled:X,className:"btn-pop px-3 py-1.5 bg-[#1DD1A1] text-white text-xs font-bold flex items-center gap-1",children:[X?e.jsx(V,{size:12,className:"animate-spin"}):e.jsx(Je,{size:12}),"å„²å­˜"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-[#636E72] mb-1",children:"ğŸ‘¦ å§“å"}),e.jsx("input",{type:"text",value:x.name||"",onChange:l=>ee("name",l.target.value),className:"w-full px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-xs font-bold text-[#636E72] mb-1 flex items-center gap-1",children:[e.jsx(Le,{size:12})," å½¢å®¹è©æ¨™ç±¤"]}),e.jsx("div",{className:"flex flex-wrap gap-1.5 min-h-[32px] p-2 bg-[#F8F4E8] rounded-lg border border-dashed border-[#2D3436]/30",children:(x.selectedTags||[]).length===0?e.jsx("span",{className:"text-xs text-[#636E72]",children:"ç„¡æ¨™ç±¤"}):x.selectedTags.map((l,d)=>e.jsxs("span",{className:"px-2 py-0.5 bg-[#54A0FF] text-white text-xs rounded-full flex items-center gap-1",children:[l,e.jsx("button",{onClick:()=>Re(l),className:"hover:bg-white/20 rounded-full p-0.5",children:e.jsx(ue,{size:10})})]},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-[#636E72] mb-1",children:"âœï¸ æ‰‹å‹•è¼¸å…¥ç‰¹è³ª"}),e.jsx("textarea",{value:x.manualTraits||"",onChange:l=>ee("manualTraits",l.target.value),className:"w-full px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium resize-none",rows:2,placeholder:"è¼¸å…¥å­¸ç”Ÿç‰¹è³ª..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-[#636E72] mb-1",children:"ğŸ¤– AI è©•èª"}),e.jsx("textarea",{value:x.comment||"",onChange:l=>ee("comment",l.target.value),className:"w-full px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium resize-none",rows:4,placeholder:"AI ç”Ÿæˆçš„è©•èª..."})]})]}):e.jsx("div",{className:"p-3",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-[#FECA57] rounded-full border-2 border-[#2D3436] flex items-center justify-center text-sm font-bold flex-shrink-0",children:String(s.id).slice(-2).padStart(2,"0")}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-[#2D3436] text-sm mb-1",children:s.name||"æœªå‘½å"}),(s.selectedTags||[]).length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-1",children:[s.selectedTags.slice(0,5).map((l,d)=>e.jsx("span",{className:"px-1.5 py-0.5 bg-[#54A0FF]/20 text-[#54A0FF] text-xs rounded",children:l},d)),s.selectedTags.length>5&&e.jsxs("span",{className:"text-xs text-[#636E72]",children:["+",s.selectedTags.length-5," æ›´å¤š"]})]}),s.manualTraits&&e.jsxs("p",{className:"text-xs text-[#636E72] mb-1 truncate",children:["âœï¸ ",s.manualTraits]}),s.comment&&e.jsxs("p",{className:"text-xs text-[#2D3436] line-clamp-2",children:["ğŸ¤– ",s.comment]})]}),e.jsx("button",{onClick:()=>Ke(s),className:"btn-pop p-2 bg-[#54A0FF] text-white flex-shrink-0",title:"ç·¨è¼¯æ­¤å­¸ç”Ÿ",children:e.jsx(fe,{size:14})})]})})},s.id))})]}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 p-4 bg-white border-2 border-[#2D3436] rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[t.photoURL?e.jsx("img",{src:t.photoURL,alt:"",className:"w-12 h-12 rounded-full border-2 border-[#2D3436]"}):e.jsx("div",{className:"w-12 h-12 bg-[#FECA57] rounded-full border-2 border-[#2D3436] flex items-center justify-center",children:"ğŸ‘¤"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-bold text-[#2D3436] flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"truncate",children:t.displayName}),$(t.role)]}),e.jsx("div",{className:"text-sm text-[#636E72] truncate",children:t.email})]})]})}),(t.requestedSchoolId||t.requestedSchoolName||((he=t.requestedClasses)==null?void 0:he.length)>0)&&e.jsxs("div",{className:"bg-[#54A0FF]/10 border-2 border-dashed border-[#54A0FF] rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-[#54A0FF] mb-2 flex items-center gap-2 text-sm",children:[e.jsx(ge,{size:16}),"ç”¨æˆ¶ç”³è«‹è³‡è¨Š"]}),t.requestedSchoolName&&e.jsxs("p",{className:"text-sm text-[#2D3436] mb-1",children:[e.jsx("span",{className:"font-medium",children:"ç”³è«‹å­¸æ ¡ï¼š"}),t.requestedSchoolCity&&`${t.requestedSchoolCity} `,t.requestedSchoolName]}),t.requestedSchoolId&&!t.requestedSchoolName&&e.jsxs("p",{className:"text-sm text-[#2D3436] mb-1",children:[e.jsx("span",{className:"font-medium",children:"ç”³è«‹å­¸æ ¡ï¼š"}),Ee(t.requestedSchoolId)]}),((pe=t.requestedClasses)==null?void 0:pe.length)>0&&e.jsxs("p",{className:"text-sm text-[#2D3436]",children:[e.jsx("span",{className:"font-medium",children:"ç”³è«‹ç­ç´šï¼š"}),t.requestedClasses.join("ã€")]})]}),e.jsxs("div",{className:"border-2 border-dashed border-[#636E72]/30 rounded-lg overflow-hidden",children:[e.jsxs("button",{onClick:()=>q(!A),className:"w-full px-4 py-2.5 bg-[#F8F4E8] flex items-center justify-between hover:bg-[#E8DCC8] transition-colors",children:[e.jsxs("span",{className:"flex items-center gap-2 text-sm font-medium text-[#636E72]",children:[e.jsx(Ye,{size:16}),"é€²éšé¸é …ï¼ˆä¿®æ”¹å­¸æ ¡/ç­ç´šï¼‰"]}),A?e.jsx(Ve,{size:18,className:"text-[#636E72]"}):e.jsx(_e,{size:18,className:"text-[#636E72]"})]}),A&&e.jsxs("div",{className:"p-3 sm:p-4 space-y-3 bg-[#F8F4E8]/50",children:[e.jsxs("div",{className:"bg-white border border-[#2D3436]/30 rounded-lg p-3",children:[e.jsxs("h4",{className:"font-bold text-[#636E72] mb-2 flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx($e,{size:14}),"æŒ‡æ´¾å…¶ä»–å­¸æ ¡ï¼ˆå¯é¸ï¼‰"]}),f.length===0?e.jsx(Ne,{onAdd:async(s,l,d)=>{await te.add({name:s,city:l,district:d})}}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1.5",children:f.map(s=>e.jsxs("button",{onClick:()=>S(g===s.id?null:s.id),className:`px-2 py-1 border border-[#2D3436]/50 rounded font-medium text-xs transition-all
                                                                  ${g===s.id?"bg-[#A29BFE] text-white border-[#A29BFE]":"bg-white hover:bg-[#A29BFE]/10"}`,children:[g===s.id&&e.jsx(R,{size:12,className:"inline mr-0.5"}),"ğŸ« ",s.name]},s.id))}),e.jsx(Ne,{compact:!0,onAdd:async(s,l,d)=>{await te.add({name:s,city:l,district:d})}})]})]}),e.jsxs("div",{className:"bg-white border border-[#2D3436]/30 rounded-lg p-3",children:[e.jsxs("h4",{className:"font-bold text-[#636E72] mb-2 flex items-center gap-2 text-xs sm:text-sm",children:[e.jsx(ve,{size:14}),"æŒ‡æ´¾ç­ç´šï¼ˆå¯é¸ï¼‰"]}),h.length===0?e.jsx(je,{onAdd:async s=>{await U.add({name:s})}}):e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"flex flex-wrap gap-1.5",children:h.map(s=>e.jsxs("button",{onClick:()=>De(s.id),className:`px-2 py-1 border border-[#2D3436]/50 rounded font-medium text-xs transition-all
                                                                  ${w.includes(s.id)?"bg-[#54A0FF] text-white border-[#54A0FF]":"bg-white hover:bg-[#54A0FF]/10"}`,children:[w.includes(s.id)&&e.jsx(R,{size:12,className:"inline mr-0.5"}),s.name]},s.id))}),e.jsx(je,{compact:!0,onAdd:async s=>{await U.add({name:s})}})]})]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>{z(null),v([])},className:"btn-pop px-4 py-2.5 bg-[#636E72] text-white font-bold order-3 sm:order-1",children:"å–æ¶ˆ"}),t.role===o.PENDING_REVIEW||t.role===o.PENDING?e.jsxs("button",{onClick:Se,className:"btn-pop px-4 py-2.5 bg-[#1DD1A1] text-white font-bold flex-1 flex items-center justify-center gap-2 order-1 sm:order-2",children:[e.jsx(R,{size:18}),"å¯©æ ¸é€šé"]}):e.jsxs("button",{onClick:Fe,className:"btn-pop px-4 py-2.5 bg-[#54A0FF] text-white font-bold flex-1 flex items-center justify-center gap-2 order-1 sm:order-2",children:[e.jsx(R,{size:18}),"æ›´æ–°ç­ç´š"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 mb-4",children:[e.jsxs("div",{className:"bg-[#FECA57] text-[#2D3436] p-2 sm:p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-black",children:H.length}),e.jsx("div",{className:"text-xs font-bold",children:"å¾…å¯©æ ¸"})]}),e.jsxs("div",{className:"bg-[#A29BFE] text-white p-2 sm:p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-black",children:M.length}),e.jsx("div",{className:"text-xs font-bold",children:"å¾…å¡«è³‡æ–™"})]}),e.jsxs("div",{className:"bg-[#1DD1A1] text-white p-2 sm:p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-black",children:m.filter(s=>s.role===o.TEACHER).length}),e.jsx("div",{className:"text-xs font-bold",children:"æ•™å¸«"})]}),e.jsxs("div",{className:"bg-[#FF6B9D] text-white p-2 sm:p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-black",children:m.filter(s=>s.role===o.ADMIN).length}),e.jsx("div",{className:"text-xs font-bold",children:"ç®¡ç†å“¡"})]})]}),e.jsxs("div",{className:"mb-6 bg-gradient-to-r from-[#FF9F43]/10 to-[#FECA57]/10 border-2 border-[#FF9F43] rounded-lg overflow-hidden",children:[e.jsx("div",{className:"p-3 bg-[#FF9F43] border-b-2 border-[#2D3436]",children:e.jsxs("h4",{className:"font-black text-white flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(Oe,{size:18}),"å…±äº« API Key ç®¡ç†",xe>0&&e.jsxs("span",{className:"ml-2 px-2 py-0.5 bg-white/20 rounded-full text-xs",children:[xe," äººå·²æˆæ¬Š"]})]})}),e.jsxs("div",{className:"p-3 sm:p-4 space-y-3",children:[e.jsxs("div",{className:"bg-white border-2 border-[#2D3436] rounded-lg p-3",children:[e.jsx("label",{className:"block text-xs font-bold text-[#636E72] mb-2",children:"ğŸ” ç®¡ç†å“¡ä»˜è²» API Key"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("input",{type:"password",value:B,onChange:s=>W(s.target.value),placeholder:"è¼¸å…¥æ‚¨çš„ä»˜è²» API Key...",className:"flex-1 px-3 py-2 border-2 border-[#2D3436] rounded-lg text-sm font-medium",disabled:L}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:Ce,disabled:!B.trim()||L,className:"btn-pop px-4 py-2 bg-[#1DD1A1] text-white text-sm font-bold disabled:opacity-50 flex items-center gap-1",children:[L?e.jsx(V,{size:14,className:"animate-spin"}):"ğŸ’¾","å„²å­˜"]}),(i==null?void 0:i.sharedApiKey)&&e.jsx("button",{onClick:ke,disabled:L,className:"btn-pop px-3 py-2 bg-[#636E72] text-white text-sm font-bold disabled:opacity-50",children:"æ¸…é™¤"})]})]}),(i==null?void 0:i.sharedApiKey)&&e.jsxs("p",{className:"text-xs text-[#1DD1A1] mt-2 font-medium",children:["âœ“ å·²è¨­å®šï¼š",ze(i.sharedApiKey)]})]}),(i==null?void 0:i.sharedApiKey)&&se.length>0&&e.jsxs("div",{className:"bg-white border-2 border-[#2D3436] rounded-lg p-3",children:[e.jsx("label",{className:"block text-xs font-bold text-[#636E72] mb-2",children:"ğŸ æˆæ¬Šæ•™å¸«ä½¿ç”¨å…±äº« API Key"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:se.map(s=>e.jsxs("div",{className:`flex items-center gap-3 p-2 rounded-lg border-2 transition-all cursor-pointer
                                                            ${G(s.id)?"bg-[#1DD1A1]/10 border-[#1DD1A1]":"bg-white border-[#2D3436]/20 hover:border-[#2D3436]/50"}`,onClick:()=>!ne&&Ie(s.id),children:[e.jsx("div",{className:`w-5 h-5 rounded border-2 flex items-center justify-center flex-shrink-0
                                                            ${G(s.id)?"bg-[#1DD1A1] border-[#1DD1A1]":"border-[#2D3436]/50"}`,children:ne===s.id?e.jsx(V,{size:12,className:"animate-spin text-white"}):G(s.id)?e.jsx(R,{size:12,className:"text-white"}):null}),s.photoURL?e.jsx("img",{src:s.photoURL,alt:"",className:"w-8 h-8 rounded-full border border-[#2D3436]"}):e.jsx("div",{className:"w-8 h-8 bg-[#FECA57] rounded-full border border-[#2D3436] flex items-center justify-center text-sm",children:"ğŸ‘¤"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-bold text-sm text-[#2D3436] truncate",children:s.displayName}),e.jsx("div",{className:"text-xs text-[#636E72] truncate",children:s.email})]}),G(s.id)&&e.jsx(Qe,{size:16,className:"text-[#1DD1A1] flex-shrink-0"})]},s.id))}),e.jsx("p",{className:"text-xs text-[#636E72] mt-2",children:"ğŸ’¡ å‹¾é¸çš„æ•™å¸«å°‡è‡ªå‹•ä½¿ç”¨æ‚¨çš„ API Keyï¼Œç„¡éœ€è‡ªè¡Œç”³è«‹"})]}),(i==null?void 0:i.sharedApiKey)&&se.length===0&&e.jsx("p",{className:"text-sm text-[#636E72] text-center py-4",children:"ç›®å‰æ²’æœ‰å·²å¯©æ ¸çš„æ•™å¸«ï¼Œè«‹å…ˆå¯©æ ¸æ•™å¸«ç”³è«‹"}),!(i!=null&&i.sharedApiKey)&&e.jsx("p",{className:"text-sm text-[#636E72] text-center py-2",children:"è«‹å…ˆè¨­å®šå…±äº« API Keyï¼Œå³å¯æˆæ¬Šçµ¦æ•™å¸«ä½¿ç”¨"})]})]}),H.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-bold text-[#FECA57] mb-2 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(Ge,{size:18}),"å¾…å¯©æ ¸ (",H.length,")"]}),H.map(s=>e.jsx(le,{user:s,onEdit:oe,onReject:J,onDelete:Y,getRoleBadge:$,formatTime:Z,classes:h,schools:f,showApplication:!0},s.id))]}),M.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-bold text-[#A29BFE] mb-2 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(ge,{size:18}),"å¾…å¡«è³‡æ–™ (",M.length,")"]}),M.map(s=>e.jsx(le,{user:s,onEdit:null,onReject:J,onDelete:Y,getRoleBadge:$,formatTime:Z,classes:h,schools:f,showApplication:!1},s.id))]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-[#1DD1A1] mb-2 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(We,{size:18}),"å·²å¯©æ ¸ä½¿ç”¨è€… (",me.length,")"]}),me.map(s=>e.jsx(le,{user:s,onEdit:oe,onReject:J,onDelete:Y,onViewStudents:qe,getRoleBadge:$,formatTime:Z,classes:h,schools:f,isCurrentUser:s.id===(c==null?void 0:c.uid),showApplication:!1},s.id))]})]})}),e.jsxs("div",{className:"p-3 sm:p-4 bg-[#E8DCC8] border-t-2 border-dashed border-[#2D3436]/20 text-xs text-[#636E72] text-center",children:["å…± ",m.length," ä½ä½¿ç”¨è€… | ç®¡ç†å“¡å¯å¯©æ ¸ä½¿ç”¨è€…ä¸¦æŒ‡æ´¾ç­ç´š"]})]})}):null},le=({user:a,onEdit:D,onReject:c,onDelete:m,onViewStudents:b,getRoleBadge:h,formatTime:u,classes:f,schools:p,isCurrentUser:E,showApplication:C})=>{var v,g;const t=(a.assignedClasses||[]).map(S=>{var A;return(A=f.find(q=>q.id===S))==null?void 0:A.name}).filter(Boolean).join(", "),z=S=>{var A;return((A=p==null?void 0:p.find(q=>q.id===S))==null?void 0:A.name)||null},w=a.role===o.PENDING_REVIEW||a.role===o.PENDING||a.role===o.PENDING_INFO;return e.jsx("div",{className:`p-3 bg-white border-2 border-[#2D3436] rounded-lg mb-2
            ${E?"ring-2 ring-[#FF6B9D]":""}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[a.photoURL?e.jsx("img",{src:a.photoURL,alt:"",className:"w-10 h-10 rounded-full border-2 border-[#2D3436] flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 bg-[#FECA57] rounded-full border-2 border-[#2D3436] flex items-center justify-center text-lg flex-shrink-0",children:"ğŸ‘¤"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-bold text-[#2D3436] text-sm flex flex-wrap items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"truncate",children:a.displayName}),h(a.role),E&&e.jsx("span",{className:"text-xs text-[#636E72]",children:"(ä½ )"})]}),e.jsx("div",{className:"text-xs text-[#636E72] truncate",children:a.email}),t&&e.jsxs("div",{className:"text-xs text-[#54A0FF] flex items-center gap-1 mt-0.5",children:[e.jsx(ve,{size:10}),e.jsx("span",{className:"truncate",children:t})]})]})]}),C&&(a.requestedSchoolId||a.requestedSchoolName||((v=a.requestedClasses)==null?void 0:v.length)>0)&&e.jsxs("div",{className:"bg-[#54A0FF]/10 rounded-lg p-2 text-xs flex-shrink-0",children:[e.jsx("div",{className:"font-medium text-[#54A0FF] mb-1",children:"ğŸ“‹ ç”³è«‹è³‡è¨Š"}),a.requestedSchoolName&&e.jsxs("div",{className:"text-[#2D3436]",children:["å­¸æ ¡ï¼š",a.requestedSchoolCity&&`${a.requestedSchoolCity} `,a.requestedSchoolName]}),a.requestedSchoolId&&!a.requestedSchoolName&&e.jsxs("div",{className:"text-[#2D3436]",children:["å­¸æ ¡ï¼š",z(a.requestedSchoolId)]}),((g=a.requestedClasses)==null?void 0:g.length)>0&&e.jsxs("div",{className:"text-[#2D3436]",children:["ç­ç´šï¼š",a.requestedClasses.join("ã€")]})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0 self-end sm:self-center",children:a.role!==o.ADMIN&&e.jsxs(e.Fragment,{children:[D&&e.jsx("button",{onClick:()=>D(a),className:"btn-pop px-3 py-1.5 bg-[#54A0FF] text-white text-xs font-bold",children:w?"å¯©æ ¸":"ç·¨è¼¯"}),a.role===o.TEACHER&&b&&e.jsx("button",{onClick:()=>b(a),className:"btn-pop p-1.5 bg-[#1DD1A1] text-white",title:"æŸ¥çœ‹å­¸ç”Ÿè³‡æ–™",children:e.jsx(ye,{size:14})}),a.role===o.TEACHER&&e.jsx("button",{onClick:()=>c(a.id),className:"btn-pop p-1.5 bg-[#FF6B6B] text-white",title:"æ’¤éŠ·æ¬Šé™",children:e.jsx(He,{size:14})}),w&&e.jsx("button",{onClick:()=>m(a.id),className:"btn-pop p-1.5 bg-[#636E72] text-white",title:"åˆªé™¤ç”³è«‹",children:e.jsx(Me,{size:14})})]})})]})})},je=({onAdd:a,compact:D=!1})=>{const[c,m]=n.useState(""),[b,h]=n.useState(!1),u=async()=>{if(c.trim()){h(!0);try{await a(c.trim()),m("")}catch(p){console.error("å»ºç«‹ç­ç´šå¤±æ•—:",p)}h(!1)}},f=p=>{p.key==="Enter"&&u()};return D?e.jsxs("div",{className:"flex gap-2 items-center pt-2 border-t border-dashed border-[#2D3436]/20",children:[e.jsx("input",{type:"text",value:c,onChange:p=>m(p.target.value),onKeyDown:f,placeholder:"æ–°å¢ç­ç´š...",className:"flex-1 px-3 py-1.5 border-2 border-[#2D3436] rounded-lg text-sm",disabled:b}),e.jsx("button",{onClick:u,disabled:!c.trim()||b,className:"btn-pop px-3 py-1.5 bg-[#1DD1A1] text-white text-xs font-bold disabled:opacity-50",children:b?"...":"+ æ–°å¢"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-[#636E72]",children:"å°šç„¡ç­ç´šï¼Œè«‹å»ºç«‹ç¬¬ä¸€å€‹ç­ç´šï¼š"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:c,onChange:p=>m(p.target.value),onKeyDown:f,placeholder:"è¼¸å…¥ç­ç´šåç¨± (ä¾‹å¦‚ï¼šä¸€å¹´ç”²ç­)",className:"flex-1 px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium",disabled:b}),e.jsx("button",{onClick:u,disabled:!c.trim()||b,className:"btn-pop px-4 py-2 bg-[#1DD1A1] text-white font-bold disabled:opacity-50 flex items-center gap-1",children:b?"å»ºç«‹ä¸­...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"+"})," å»ºç«‹ç­ç´š"]})})]})]})},Ne=({onAdd:a,compact:D=!1})=>{const[c,m]=n.useState(""),[b,h]=n.useState(""),[u,f]=n.useState(!1),p=async()=>{if(c.trim()){f(!0);try{await a(c.trim(),b.trim()||null,null),m(""),h("")}catch(t){console.error("å»ºç«‹å­¸æ ¡å¤±æ•—:",t)}f(!1)}},E=t=>{t.key==="Enter"&&p()},C=["å°åŒ—å¸‚","æ–°åŒ—å¸‚","æ¡ƒåœ’å¸‚","å°ä¸­å¸‚","å°å—å¸‚","é«˜é›„å¸‚","åŸºéš†å¸‚","æ–°ç«¹å¸‚","æ–°ç«¹ç¸£","è‹—æ —ç¸£","å½°åŒ–ç¸£","å—æŠ•ç¸£","é›²æ—ç¸£","å˜‰ç¾©å¸‚","å˜‰ç¾©ç¸£","å±æ±ç¸£","å®œè˜­ç¸£","èŠ±è“®ç¸£","å°æ±ç¸£","æ¾æ¹–ç¸£","é‡‘é–€ç¸£","é€£æ±Ÿç¸£"];return D?e.jsxs("div",{className:"flex flex-wrap gap-2 items-center pt-2 border-t border-dashed border-[#2D3436]/20",children:[e.jsxs("select",{value:b,onChange:t=>h(t.target.value),className:"px-2 py-1.5 border-2 border-[#2D3436] rounded-lg text-sm bg-white",disabled:u,children:[e.jsx("option",{value:"",children:"ç¸£å¸‚"}),C.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",value:c,onChange:t=>m(t.target.value),onKeyDown:E,placeholder:"å­¸æ ¡åç¨±...",className:"flex-1 min-w-[120px] px-3 py-1.5 border-2 border-[#2D3436] rounded-lg text-sm",disabled:u}),e.jsx("button",{onClick:p,disabled:!c.trim()||u,className:"btn-pop px-3 py-1.5 bg-[#A29BFE] text-white text-xs font-bold disabled:opacity-50",children:u?"...":"+ æ–°å¢"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-[#636E72]",children:"å°šç„¡å­¸æ ¡ï¼Œè«‹å»ºç«‹ç¬¬ä¸€å€‹å­¸æ ¡ï¼š"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("select",{value:b,onChange:t=>h(t.target.value),className:"px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium bg-white",disabled:u,children:[e.jsx("option",{value:"",children:"é¸æ“‡ç¸£å¸‚"}),C.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",value:c,onChange:t=>m(t.target.value),onKeyDown:E,placeholder:"è¼¸å…¥å­¸æ ¡åç¨± (ä¾‹å¦‚ï¼šå°åŒ—å¸‚ç«‹åœ‹èªå¯¦å°)",className:"flex-1 min-w-[200px] px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium",disabled:u}),e.jsx("button",{onClick:p,disabled:!c.trim()||u,className:"btn-pop px-4 py-2 bg-[#A29BFE] text-white font-bold disabled:opacity-50 flex items-center gap-1",children:u?"å»ºç«‹ä¸­...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ğŸ«"})," å»ºç«‹å­¸æ ¡"]})})]})]})};export{as as default};
