import{c as X,r as h,u as C,b as B,g as z,U as n,j as e,i as J,X as Y,B as Z,e as S,d as K,f as ee,k as se,T as te}from"./index-uyl9mPgW.js";import{F as T}from"./file-text-Cou1lwIe.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=X("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),de=({isOpen:l,onClose:u,currentUser:a})=>{var _,P;const[d,x]=h.useState([]),[m,r]=h.useState([]),[i,c]=h.useState([]),[D,j]=h.useState(!0),[t,N]=h.useState(null),[v,b]=h.useState([]),[g,f]=h.useState(null);h.useEffect(()=>{if(!l)return;j(!0);const s=C.subscribeAll(w=>{x(w),j(!1)}),o=B.subscribe(w=>{r(w)}),p=z.subscribe(w=>{c(w)});return()=>{s(),o(),p()}},[l]);const y=s=>{var o,p;if(N(s),f(s.schoolId||s.requestedSchoolId||null),((o=s.assignedClasses)==null?void 0:o.length)>0)b(s.assignedClasses);else if(((p=s.requestedClasses)==null?void 0:p.length)>0){const w=s.requestedClasses.map(O=>{var G;return(G=m.find(Q=>Q.name===O))==null?void 0:G.id}).filter(Boolean);b(w)}else b([])},H=s=>{b(o=>o.includes(s)?o.filter(p=>p!==s):[...o,s])},W=async()=>{t&&(await C.approve(t.id,v,g),N(null),b([]),f(null))},V=async()=>{t&&(await C.updateAssignedClasses(t.id,v,g),N(null),b([]),f(null))},k=async s=>{window.confirm("ç¢ºå®šè¦æ‹’çµ•/æ’¤éŠ·æ­¤ä½¿ç”¨è€…çš„æ¬Šé™å—ï¼Ÿå°‡é‡ç½®ç‚ºå¾…å¡«è³‡æ–™ç‹€æ…‹ã€‚")&&await C.reject(s)},I=async s=>{window.confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ä½¿ç”¨è€…å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚")&&await C.delete(s)},E=s=>{switch(s){case n.ADMIN:return e.jsx("span",{className:"px-2 py-0.5 bg-[#FF6B9D] text-white text-xs font-bold rounded-full",children:"ç®¡ç†å“¡"});case n.TEACHER:return e.jsx("span",{className:"px-2 py-0.5 bg-[#1DD1A1] text-white text-xs font-bold rounded-full",children:"æ•™å¸«"});case n.PENDING_REVIEW:return e.jsx("span",{className:"px-2 py-0.5 bg-[#FECA57] text-[#2D3436] text-xs font-bold rounded-full",children:"å¾…å¯©æ ¸"});case n.PENDING_INFO:return e.jsx("span",{className:"px-2 py-0.5 bg-[#A29BFE] text-white text-xs font-bold rounded-full",children:"å¾…å¡«è³‡æ–™"});default:return e.jsx("span",{className:"px-2 py-0.5 bg-[#FECA57] text-[#2D3436] text-xs font-bold rounded-full",children:"å¾…å¯©æ ¸"})}},R=s=>s!=null&&s.toDate?s.toDate().toLocaleDateString("zh-TW"):"-",$=s=>{var o;return((o=i.find(p=>p.id===s))==null?void 0:o.name)||"æœªçŸ¥å­¸æ ¡"},A=d.filter(s=>s.role===n.PENDING_REVIEW||s.role===n.PENDING),F=d.filter(s=>s.role===n.PENDING_INFO),U=d.filter(s=>s.role===n.TEACHER||s.role===n.ADMIN);return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-2 sm:p-4",children:e.jsxs("div",{className:"card-pop w-full max-w-4xl max-h-[90vh] flex flex-col animate-in bg-[#FFF9E6]",children:[e.jsxs("div",{className:"p-3 sm:p-5 bg-[#FF6B9D] border-b-3 border-[#2D3436] flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-white flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(J,{size:24}),"ç®¡ç†å“¡é¢æ¿"]}),e.jsx("button",{onClick:u,className:"btn-pop p-2 bg-white text-[#2D3436]",children:e.jsx(Y,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 sm:p-4 mobile-scroll-hide",children:D?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"text-4xl animate-bounce",children:"ğŸ‘¥"})}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3 p-4 bg-white border-2 border-[#2D3436] rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[t.photoURL?e.jsx("img",{src:t.photoURL,alt:"",className:"w-12 h-12 rounded-full border-2 border-[#2D3436]"}):e.jsx("div",{className:"w-12 h-12 bg-[#FECA57] rounded-full border-2 border-[#2D3436] flex items-center justify-center",children:"ğŸ‘¤"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-bold text-[#2D3436] flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"truncate",children:t.displayName}),E(t.role)]}),e.jsx("div",{className:"text-sm text-[#636E72] truncate",children:t.email})]})]})}),(t.requestedSchoolId||((_=t.requestedClasses)==null?void 0:_.length)>0)&&e.jsxs("div",{className:"bg-[#54A0FF]/10 border-2 border-dashed border-[#54A0FF] rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-[#54A0FF] mb-2 flex items-center gap-2 text-sm",children:[e.jsx(T,{size:16}),"ç”¨æˆ¶ç”³è«‹è³‡è¨Š"]}),t.requestedSchoolId&&e.jsxs("p",{className:"text-sm text-[#2D3436] mb-1",children:[e.jsx("span",{className:"font-medium",children:"ç”³è«‹å­¸æ ¡ï¼š"}),$(t.requestedSchoolId)]}),((P=t.requestedClasses)==null?void 0:P.length)>0&&e.jsxs("p",{className:"text-sm text-[#2D3436]",children:[e.jsx("span",{className:"font-medium",children:"ç”³è«‹ç­ç´šï¼š"}),t.requestedClasses.join("ã€")]})]}),e.jsxs("div",{className:"bg-white border-2 border-[#2D3436] rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-[#2D3436] mb-3 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(Z,{size:18}),"æŒ‡æ´¾å­¸æ ¡"]}),i.length===0?e.jsx(M,{onAdd:async(s,o,p)=>{await z.add({name:s,city:o,district:p})}}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(s=>e.jsxs("button",{onClick:()=>f(g===s.id?null:s.id),className:`px-3 py-2 border-2 border-[#2D3436] rounded-lg font-bold text-xs sm:text-sm transition-all
                                                      ${g===s.id?"bg-[#A29BFE] text-white shadow-[2px_2px_0_#2D3436]":"bg-white hover:bg-[#A29BFE]/20"}`,children:[g===s.id&&e.jsx(S,{size:14,className:"inline mr-1"}),"ğŸ« ",s.name,s.city&&e.jsxs("span",{className:"text-xs opacity-70 ml-1",children:["(",s.city,")"]})]},s.id))}),e.jsx(M,{compact:!0,onAdd:async(s,o,p)=>{await z.add({name:s,city:o,district:p})}})]})]}),e.jsxs("div",{className:"bg-white border-2 border-[#2D3436] rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-[#2D3436] mb-3 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(K,{size:18}),"æŒ‡æ´¾ç­ç´š"]}),m.length===0?e.jsx(L,{onAdd:async s=>{await B.add({name:s})}}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(s=>e.jsxs("button",{onClick:()=>H(s.id),className:`px-3 py-2 border-2 border-[#2D3436] rounded-lg font-bold text-xs sm:text-sm transition-all
                                                      ${v.includes(s.id)?"bg-[#54A0FF] text-white shadow-[2px_2px_0_#2D3436]":"bg-white hover:bg-[#FECA57]/20"}`,children:[v.includes(s.id)&&e.jsx(S,{size:14,className:"inline mr-1"}),s.name]},s.id))}),e.jsx(L,{compact:!0,onAdd:async s=>{await B.add({name:s})}})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsx("button",{onClick:()=>{N(null),b([])},className:"btn-pop px-4 py-2.5 bg-[#636E72] text-white font-bold order-3 sm:order-1",children:"å–æ¶ˆ"}),t.role===n.PENDING_REVIEW||t.role===n.PENDING?e.jsxs("button",{onClick:W,className:"btn-pop px-4 py-2.5 bg-[#1DD1A1] text-white font-bold flex-1 flex items-center justify-center gap-2 order-1 sm:order-2",children:[e.jsx(S,{size:18}),"å¯©æ ¸é€šé"]}):e.jsxs("button",{onClick:V,className:"btn-pop px-4 py-2.5 bg-[#54A0FF] text-white font-bold flex-1 flex items-center justify-center gap-2 order-1 sm:order-2",children:[e.jsx(S,{size:18}),"æ›´æ–°ç­ç´š"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 sm:gap-3 mb-4",children:[e.jsxs("div",{className:"bg-[#FECA57] text-[#2D3436] p-2 sm:p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-black",children:A.length}),e.jsx("div",{className:"text-xs font-bold",children:"å¾…å¯©æ ¸"})]}),e.jsxs("div",{className:"bg-[#A29BFE] text-white p-2 sm:p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-black",children:F.length}),e.jsx("div",{className:"text-xs font-bold",children:"å¾…å¡«è³‡æ–™"})]}),e.jsxs("div",{className:"bg-[#1DD1A1] text-white p-2 sm:p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-black",children:d.filter(s=>s.role===n.TEACHER).length}),e.jsx("div",{className:"text-xs font-bold",children:"æ•™å¸«"})]}),e.jsxs("div",{className:"bg-[#FF6B9D] text-white p-2 sm:p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-xl sm:text-2xl font-black",children:d.filter(s=>s.role===n.ADMIN).length}),e.jsx("div",{className:"text-xs font-bold",children:"ç®¡ç†å“¡"})]})]}),A.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-bold text-[#FECA57] mb-2 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(ee,{size:18}),"å¾…å¯©æ ¸ (",A.length,")"]}),A.map(s=>e.jsx(q,{user:s,onEdit:y,onReject:k,onDelete:I,getRoleBadge:E,formatTime:R,classes:m,schools:i,showApplication:!0},s.id))]}),F.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-bold text-[#A29BFE] mb-2 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(T,{size:18}),"å¾…å¡«è³‡æ–™ (",F.length,")"]}),F.map(s=>e.jsx(q,{user:s,onEdit:null,onReject:k,onDelete:I,getRoleBadge:E,formatTime:R,classes:m,schools:i,showApplication:!1},s.id))]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-[#1DD1A1] mb-2 flex items-center gap-2 text-sm sm:text-base",children:[e.jsx(le,{size:18}),"å·²å¯©æ ¸ä½¿ç”¨è€… (",U.length,")"]}),U.map(s=>e.jsx(q,{user:s,onEdit:y,onReject:k,onDelete:I,getRoleBadge:E,formatTime:R,classes:m,schools:i,isCurrentUser:s.id===(a==null?void 0:a.uid),showApplication:!1},s.id))]})]})}),e.jsxs("div",{className:"p-3 sm:p-4 bg-[#E8DCC8] border-t-2 border-dashed border-[#2D3436]/20 text-xs text-[#636E72] text-center",children:["å…± ",d.length," ä½ä½¿ç”¨è€… | ç®¡ç†å“¡å¯å¯©æ ¸ä½¿ç”¨è€…ä¸¦æŒ‡æ´¾ç­ç´š"]})]})}):null},q=({user:l,onEdit:u,onReject:a,onDelete:d,getRoleBadge:x,formatTime:m,classes:r,schools:i,isCurrentUser:c,showApplication:D})=>{var v,b;const j=(l.assignedClasses||[]).map(g=>{var f;return(f=r.find(y=>y.id===g))==null?void 0:f.name}).filter(Boolean).join(", "),t=g=>{var f;return((f=i==null?void 0:i.find(y=>y.id===g))==null?void 0:f.name)||null},N=l.role===n.PENDING_REVIEW||l.role===n.PENDING||l.role===n.PENDING_INFO;return e.jsx("div",{className:`p-3 bg-white border-2 border-[#2D3436] rounded-lg mb-2
            ${c?"ring-2 ring-[#FF6B9D]":""}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[l.photoURL?e.jsx("img",{src:l.photoURL,alt:"",className:"w-10 h-10 rounded-full border-2 border-[#2D3436] flex-shrink-0"}):e.jsx("div",{className:"w-10 h-10 bg-[#FECA57] rounded-full border-2 border-[#2D3436] flex items-center justify-center text-lg flex-shrink-0",children:"ğŸ‘¤"}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsxs("div",{className:"font-bold text-[#2D3436] text-sm flex flex-wrap items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"truncate",children:l.displayName}),x(l.role),c&&e.jsx("span",{className:"text-xs text-[#636E72]",children:"(ä½ )"})]}),e.jsx("div",{className:"text-xs text-[#636E72] truncate",children:l.email}),j&&e.jsxs("div",{className:"text-xs text-[#54A0FF] flex items-center gap-1 mt-0.5",children:[e.jsx(K,{size:10}),e.jsx("span",{className:"truncate",children:j})]})]})]}),D&&(l.requestedSchoolId||((v=l.requestedClasses)==null?void 0:v.length)>0)&&e.jsxs("div",{className:"bg-[#54A0FF]/10 rounded-lg p-2 text-xs flex-shrink-0",children:[e.jsx("div",{className:"font-medium text-[#54A0FF] mb-1",children:"ğŸ“‹ ç”³è«‹è³‡è¨Š"}),l.requestedSchoolId&&e.jsxs("div",{className:"text-[#2D3436]",children:["å­¸æ ¡ï¼š",t(l.requestedSchoolId)]}),((b=l.requestedClasses)==null?void 0:b.length)>0&&e.jsxs("div",{className:"text-[#2D3436]",children:["ç­ç´šï¼š",l.requestedClasses.join("ã€")]})]}),e.jsx("div",{className:"flex items-center gap-1 flex-shrink-0 self-end sm:self-center",children:l.role!==n.ADMIN&&e.jsxs(e.Fragment,{children:[u&&e.jsx("button",{onClick:()=>u(l),className:"btn-pop px-3 py-1.5 bg-[#54A0FF] text-white text-xs font-bold",children:N?"å¯©æ ¸":"ç·¨è¼¯"}),l.role===n.TEACHER&&e.jsx("button",{onClick:()=>a(l.id),className:"btn-pop p-1.5 bg-[#FF6B6B] text-white",title:"æ’¤éŠ·æ¬Šé™",children:e.jsx(se,{size:14})}),N&&e.jsx("button",{onClick:()=>d(l.id),className:"btn-pop p-1.5 bg-[#636E72] text-white",title:"åˆªé™¤ç”³è«‹",children:e.jsx(te,{size:14})})]})})]})})},L=({onAdd:l,compact:u=!1})=>{const[a,d]=h.useState(""),[x,m]=h.useState(!1),r=async()=>{if(a.trim()){m(!0);try{await l(a.trim()),d("")}catch(c){console.error("å»ºç«‹ç­ç´šå¤±æ•—:",c)}m(!1)}},i=c=>{c.key==="Enter"&&r()};return u?e.jsxs("div",{className:"flex gap-2 items-center pt-2 border-t border-dashed border-[#2D3436]/20",children:[e.jsx("input",{type:"text",value:a,onChange:c=>d(c.target.value),onKeyDown:i,placeholder:"æ–°å¢ç­ç´š...",className:"flex-1 px-3 py-1.5 border-2 border-[#2D3436] rounded-lg text-sm",disabled:x}),e.jsx("button",{onClick:r,disabled:!a.trim()||x,className:"btn-pop px-3 py-1.5 bg-[#1DD1A1] text-white text-xs font-bold disabled:opacity-50",children:x?"...":"+ æ–°å¢"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-[#636E72]",children:"å°šç„¡ç­ç´šï¼Œè«‹å»ºç«‹ç¬¬ä¸€å€‹ç­ç´šï¼š"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:c=>d(c.target.value),onKeyDown:i,placeholder:"è¼¸å…¥ç­ç´šåç¨± (ä¾‹å¦‚ï¼šä¸€å¹´ç”²ç­)",className:"flex-1 px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium",disabled:x}),e.jsx("button",{onClick:r,disabled:!a.trim()||x,className:"btn-pop px-4 py-2 bg-[#1DD1A1] text-white font-bold disabled:opacity-50 flex items-center gap-1",children:x?"å»ºç«‹ä¸­...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"+"})," å»ºç«‹ç­ç´š"]})})]})]})},M=({onAdd:l,compact:u=!1})=>{const[a,d]=h.useState(""),[x,m]=h.useState(""),[r,i]=h.useState(!1),c=async()=>{if(a.trim()){i(!0);try{await l(a.trim(),x.trim()||null,null),d(""),m("")}catch(t){console.error("å»ºç«‹å­¸æ ¡å¤±æ•—:",t)}i(!1)}},D=t=>{t.key==="Enter"&&c()},j=["å°åŒ—å¸‚","æ–°åŒ—å¸‚","æ¡ƒåœ’å¸‚","å°ä¸­å¸‚","å°å—å¸‚","é«˜é›„å¸‚","åŸºéš†å¸‚","æ–°ç«¹å¸‚","æ–°ç«¹ç¸£","è‹—æ —ç¸£","å½°åŒ–ç¸£","å—æŠ•ç¸£","é›²æ—ç¸£","å˜‰ç¾©å¸‚","å˜‰ç¾©ç¸£","å±æ±ç¸£","å®œè˜­ç¸£","èŠ±è“®ç¸£","å°æ±ç¸£","æ¾æ¹–ç¸£","é‡‘é–€ç¸£","é€£æ±Ÿç¸£"];return u?e.jsxs("div",{className:"flex flex-wrap gap-2 items-center pt-2 border-t border-dashed border-[#2D3436]/20",children:[e.jsxs("select",{value:x,onChange:t=>m(t.target.value),className:"px-2 py-1.5 border-2 border-[#2D3436] rounded-lg text-sm bg-white",disabled:r,children:[e.jsx("option",{value:"",children:"ç¸£å¸‚"}),j.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",value:a,onChange:t=>d(t.target.value),onKeyDown:D,placeholder:"å­¸æ ¡åç¨±...",className:"flex-1 min-w-[120px] px-3 py-1.5 border-2 border-[#2D3436] rounded-lg text-sm",disabled:r}),e.jsx("button",{onClick:c,disabled:!a.trim()||r,className:"btn-pop px-3 py-1.5 bg-[#A29BFE] text-white text-xs font-bold disabled:opacity-50",children:r?"...":"+ æ–°å¢"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-[#636E72]",children:"å°šç„¡å­¸æ ¡ï¼Œè«‹å»ºç«‹ç¬¬ä¸€å€‹å­¸æ ¡ï¼š"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("select",{value:x,onChange:t=>m(t.target.value),className:"px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium bg-white",disabled:r,children:[e.jsx("option",{value:"",children:"é¸æ“‡ç¸£å¸‚"}),j.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",value:a,onChange:t=>d(t.target.value),onKeyDown:D,placeholder:"è¼¸å…¥å­¸æ ¡åç¨± (ä¾‹å¦‚ï¼šå°åŒ—å¸‚ç«‹åœ‹èªå¯¦å°)",className:"flex-1 min-w-[200px] px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium",disabled:r}),e.jsx("button",{onClick:c,disabled:!a.trim()||r,className:"btn-pop px-4 py-2 bg-[#A29BFE] text-white font-bold disabled:opacity-50 flex items-center gap-1",children:r?"å»ºç«‹ä¸­...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ğŸ«"})," å»ºç«‹å­¸æ ¡"]})})]})]})};export{de as default};
