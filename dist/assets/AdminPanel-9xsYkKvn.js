import{c as M,r as x,u as w,b as E,f as k,j as e,g as _,X as K,d as U,U as o,e as T,i as H}from"./index-Bn5A4t6f.js";import{C}from"./check-DoRn9BXH.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=M("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $=M("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),V=({isOpen:l,onClose:m,currentUser:a})=>{const[d,i]=x.useState([]),[c,n]=x.useState([]),[h,r]=x.useState([]),[b,u]=x.useState(!0),[t,y]=x.useState(null),[v,j]=x.useState([]),[g,D]=x.useState(null);x.useEffect(()=>{if(!l)return;u(!0);const s=w.subscribeAll(N=>{i(N),u(!1)}),p=E.subscribe(N=>{n(N)}),f=k.subscribe(N=>{r(N)});return()=>{s(),p(),f()}},[l]);const F=s=>{y(s),j(s.assignedClasses||[]),D(s.schoolId||null)},L=s=>{j(p=>p.includes(s)?p.filter(f=>f!==s):[...p,s])},P=async()=>{t&&(await w.approve(t.id,v,g),y(null),j([]),D(null))},G=async()=>{t&&(await w.updateAssignedClasses(t.id,v,g),y(null),j([]),D(null))},S=async s=>{window.confirm("ç¢ºå®šè¦æ‹’çµ•/æ’¤éŠ·æ­¤ä½¿ç”¨è€…çš„æ¬Šé™å—ï¼Ÿ")&&await w.reject(s)},A=s=>{switch(s){case o.ADMIN:return e.jsx("span",{className:"px-2 py-0.5 bg-[#FF6B9D] text-white text-xs font-bold rounded-full",children:"ç®¡ç†å“¡"});case o.TEACHER:return e.jsx("span",{className:"px-2 py-0.5 bg-[#1DD1A1] text-white text-xs font-bold rounded-full",children:"æ•™å¸«"});default:return e.jsx("span",{className:"px-2 py-0.5 bg-[#FECA57] text-[#2D3436] text-xs font-bold rounded-full",children:"å¾…å¯©æ ¸"})}},z=s=>s!=null&&s.toDate?s.toDate().toLocaleDateString("zh-TW"):"-";return l?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-2 sm:p-4",children:e.jsxs("div",{className:"card-pop w-full max-w-4xl max-h-[90vh] flex flex-col animate-in bg-[#FFF9E6]",children:[e.jsxs("div",{className:"p-3 sm:p-5 bg-[#FF6B9D] border-b-3 border-[#2D3436] flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-white flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(_,{size:24}),"ç®¡ç†å“¡é¢æ¿"]}),e.jsx("button",{onClick:m,className:"btn-pop p-2 bg-white text-[#2D3436]",children:e.jsx(K,{size:20})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 sm:p-4 mobile-scroll-hide",children:b?e.jsx("div",{className:"flex items-center justify-center py-20",children:e.jsx("div",{className:"text-4xl animate-bounce",children:"ğŸ‘¥"})}):t?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-3 p-4 bg-white border-2 border-[#2D3436] rounded-lg",children:[t.photoURL?e.jsx("img",{src:t.photoURL,alt:"",className:"w-12 h-12 rounded-full border-2 border-[#2D3436]"}):e.jsx("div",{className:"w-12 h-12 bg-[#FECA57] rounded-full border-2 border-[#2D3436] flex items-center justify-center",children:"ğŸ‘¤"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-bold text-[#2D3436]",children:t.displayName}),e.jsx("div",{className:"text-sm text-[#636E72]",children:t.email})]}),A(t.role)]}),e.jsxs("div",{className:"bg-white border-2 border-[#2D3436] rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-[#2D3436] mb-3 flex items-center gap-2",children:[e.jsx(q,{size:18}),"æŒ‡æ´¾å­¸æ ¡"]}),h.length===0?e.jsx(I,{onAdd:async(s,p,f)=>{await k.add({name:s,city:p,district:f})}}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map(s=>e.jsxs("button",{onClick:()=>D(g===s.id?null:s.id),className:`px-3 py-2 border-2 border-[#2D3436] rounded-lg font-bold text-sm transition-all
                                                      ${g===s.id?"bg-[#A29BFE] text-white shadow-[2px_2px_0_#2D3436]":"bg-white hover:bg-[#A29BFE]/20"}`,children:[g===s.id&&e.jsx(C,{size:14,className:"inline mr-1"}),"ğŸ« ",s.name,s.city&&e.jsxs("span",{className:"text-xs opacity-70 ml-1",children:["(",s.city,")"]})]},s.id))}),e.jsx(I,{compact:!0,onAdd:async(s,p,f)=>{await k.add({name:s,city:p,district:f})}})]})]}),e.jsxs("div",{className:"bg-white border-2 border-[#2D3436] rounded-lg p-4",children:[e.jsxs("h4",{className:"font-bold text-[#2D3436] mb-3 flex items-center gap-2",children:[e.jsx(U,{size:18}),"æŒ‡æ´¾ç­ç´š"]}),c.length===0?e.jsx(B,{onAdd:async s=>{await E.add({name:s})}}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:c.map(s=>e.jsxs("button",{onClick:()=>L(s.id),className:`px-3 py-2 border-2 border-[#2D3436] rounded-lg font-bold text-sm transition-all
                          ${v.includes(s.id)?"bg-[#54A0FF] text-white shadow-[2px_2px_0_#2D3436]":"bg-white hover:bg-[#FECA57]/20"}`,children:[v.includes(s.id)&&e.jsx(C,{size:14,className:"inline mr-1"}),s.name]},s.id))}),e.jsx(B,{compact:!0,onAdd:async s=>{await E.add({name:s})}})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{y(null),j([])},className:"btn-pop px-4 py-2 bg-[#636E72] text-white font-bold",children:"å–æ¶ˆ"}),t.role===o.PENDING?e.jsxs("button",{onClick:P,className:"btn-pop px-4 py-2 bg-[#1DD1A1] text-white font-bold flex-1 flex items-center justify-center gap-2",children:[e.jsx(C,{size:18}),"å¯©æ ¸é€šé"]}):e.jsxs("button",{onClick:G,className:"btn-pop px-4 py-2 bg-[#54A0FF] text-white font-bold flex-1 flex items-center justify-center gap-2",children:[e.jsx(C,{size:18}),"æ›´æ–°ç­ç´š"]})]})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{className:"bg-[#FECA57] text-[#2D3436] p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-black",children:d.filter(s=>s.role===o.PENDING).length}),e.jsx("div",{className:"text-xs font-bold",children:"å¾…å¯©æ ¸"})]}),e.jsxs("div",{className:"bg-[#1DD1A1] text-white p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-black",children:d.filter(s=>s.role===o.TEACHER).length}),e.jsx("div",{className:"text-xs font-bold",children:"æ•™å¸«"})]}),e.jsxs("div",{className:"bg-[#FF6B9D] text-white p-3 border-2 border-[#2D3436] rounded-lg text-center",children:[e.jsx("div",{className:"text-2xl font-black",children:d.filter(s=>s.role===o.ADMIN).length}),e.jsx("div",{className:"text-xs font-bold",children:"ç®¡ç†å“¡"})]})]}),d.filter(s=>s.role===o.PENDING).length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-bold text-[#FECA57] mb-2 flex items-center gap-2",children:[e.jsx(T,{size:18}),"å¾…å¯©æ ¸ (",d.filter(s=>s.role===o.PENDING).length,")"]}),d.filter(s=>s.role===o.PENDING).map(s=>e.jsx(R,{user:s,onEdit:F,onReject:S,getRoleBadge:A,formatTime:z,classes:c},s.id))]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-bold text-[#1DD1A1] mb-2 flex items-center gap-2",children:[e.jsx($,{size:18}),"å·²å¯©æ ¸ä½¿ç”¨è€…"]}),d.filter(s=>s.role!==o.PENDING).map(s=>e.jsx(R,{user:s,onEdit:F,onReject:S,getRoleBadge:A,formatTime:z,classes:c,isCurrentUser:s.id===(a==null?void 0:a.uid)},s.id))]})]})}),e.jsxs("div",{className:"p-3 sm:p-4 bg-[#E8DCC8] border-t-2 border-dashed border-[#2D3436]/20 text-xs text-[#636E72] text-center",children:["å…± ",d.length," ä½ä½¿ç”¨è€… | ç®¡ç†å“¡å¯å¯©æ ¸ä½¿ç”¨è€…ä¸¦æŒ‡æ´¾ç­ç´š"]})]})}):null},R=({user:l,onEdit:m,onReject:a,getRoleBadge:d,formatTime:i,classes:c,isCurrentUser:n})=>{const h=(l.assignedClasses||[]).map(r=>{var b;return(b=c.find(u=>u.id===r))==null?void 0:b.name}).filter(Boolean).join(", ");return e.jsxs("div",{className:`p-3 bg-white border-2 border-[#2D3436] rounded-lg mb-2 flex items-center justify-between
      ${n?"ring-2 ring-[#FF6B9D]":""}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l.photoURL?e.jsx("img",{src:l.photoURL,alt:"",className:"w-10 h-10 rounded-full border-2 border-[#2D3436]"}):e.jsx("div",{className:"w-10 h-10 bg-[#FECA57] rounded-full border-2 border-[#2D3436] flex items-center justify-center text-lg",children:"ğŸ‘¤"}),e.jsxs("div",{children:[e.jsxs("div",{className:"font-bold text-[#2D3436] text-sm flex items-center gap-2",children:[l.displayName,d(l.role),n&&e.jsx("span",{className:"text-xs text-[#636E72]",children:"(ä½ )"})]}),e.jsx("div",{className:"text-xs text-[#636E72]",children:l.email}),h&&e.jsxs("div",{className:"text-xs text-[#54A0FF] flex items-center gap-1 mt-0.5",children:[e.jsx(U,{size:10}),h]})]})]}),e.jsx("div",{className:"flex items-center gap-1",children:l.role!==o.ADMIN&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>m(l),className:"btn-pop px-3 py-1.5 bg-[#54A0FF] text-white text-xs font-bold",children:l.role===o.PENDING?"å¯©æ ¸":"ç·¨è¼¯"}),l.role===o.TEACHER&&e.jsx("button",{onClick:()=>a(l.id),className:"btn-pop p-1.5 bg-[#FF6B6B] text-white",children:e.jsx(H,{size:14})})]})})]})},B=({onAdd:l,compact:m=!1})=>{const[a,d]=x.useState(""),[i,c]=x.useState(!1),n=async()=>{if(a.trim()){c(!0);try{await l(a.trim()),d("")}catch(r){console.error("å»ºç«‹ç­ç´šå¤±æ•—:",r)}c(!1)}},h=r=>{r.key==="Enter"&&n()};return m?e.jsxs("div",{className:"flex gap-2 items-center pt-2 border-t border-dashed border-[#2D3436]/20",children:[e.jsx("input",{type:"text",value:a,onChange:r=>d(r.target.value),onKeyDown:h,placeholder:"æ–°å¢ç­ç´š...",className:"flex-1 px-3 py-1.5 border-2 border-[#2D3436] rounded-lg text-sm",disabled:i}),e.jsx("button",{onClick:n,disabled:!a.trim()||i,className:"btn-pop px-3 py-1.5 bg-[#1DD1A1] text-white text-xs font-bold disabled:opacity-50",children:i?"...":"+ æ–°å¢"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-[#636E72]",children:"å°šç„¡ç­ç´šï¼Œè«‹å»ºç«‹ç¬¬ä¸€å€‹ç­ç´šï¼š"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:a,onChange:r=>d(r.target.value),onKeyDown:h,placeholder:"è¼¸å…¥ç­ç´šåç¨± (ä¾‹å¦‚ï¼šä¸€å¹´ç”²ç­)",className:"flex-1 px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium",disabled:i}),e.jsx("button",{onClick:n,disabled:!a.trim()||i,className:"btn-pop px-4 py-2 bg-[#1DD1A1] text-white font-bold disabled:opacity-50 flex items-center gap-1",children:i?"å»ºç«‹ä¸­...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"+"})," å»ºç«‹ç­ç´š"]})})]})]})},I=({onAdd:l,compact:m=!1})=>{const[a,d]=x.useState(""),[i,c]=x.useState(""),[n,h]=x.useState(!1),r=async()=>{if(a.trim()){h(!0);try{await l(a.trim(),i.trim()||null,null),d(""),c("")}catch(t){console.error("å»ºç«‹å­¸æ ¡å¤±æ•—:",t)}h(!1)}},b=t=>{t.key==="Enter"&&r()},u=["å°åŒ—å¸‚","æ–°åŒ—å¸‚","æ¡ƒåœ’å¸‚","å°ä¸­å¸‚","å°å—å¸‚","é«˜é›„å¸‚","åŸºéš†å¸‚","æ–°ç«¹å¸‚","æ–°ç«¹ç¸£","è‹—æ —ç¸£","å½°åŒ–ç¸£","å—æŠ•ç¸£","é›²æ—ç¸£","å˜‰ç¾©å¸‚","å˜‰ç¾©ç¸£","å±æ±ç¸£","å®œè˜­ç¸£","èŠ±è“®ç¸£","å°æ±ç¸£","æ¾æ¹–ç¸£","é‡‘é–€ç¸£","é€£æ±Ÿç¸£"];return m?e.jsxs("div",{className:"flex gap-2 items-center pt-2 border-t border-dashed border-[#2D3436]/20",children:[e.jsxs("select",{value:i,onChange:t=>c(t.target.value),className:"px-2 py-1.5 border-2 border-[#2D3436] rounded-lg text-sm bg-white",disabled:n,children:[e.jsx("option",{value:"",children:"ç¸£å¸‚"}),u.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",value:a,onChange:t=>d(t.target.value),onKeyDown:b,placeholder:"å­¸æ ¡åç¨±...",className:"flex-1 px-3 py-1.5 border-2 border-[#2D3436] rounded-lg text-sm",disabled:n}),e.jsx("button",{onClick:r,disabled:!a.trim()||n,className:"btn-pop px-3 py-1.5 bg-[#A29BFE] text-white text-xs font-bold disabled:opacity-50",children:n?"...":"+ æ–°å¢"})]}):e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-[#636E72]",children:"å°šç„¡å­¸æ ¡ï¼Œè«‹å»ºç«‹ç¬¬ä¸€å€‹å­¸æ ¡ï¼š"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("select",{value:i,onChange:t=>c(t.target.value),className:"px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium bg-white",disabled:n,children:[e.jsx("option",{value:"",children:"é¸æ“‡ç¸£å¸‚"}),u.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsx("input",{type:"text",value:a,onChange:t=>d(t.target.value),onKeyDown:b,placeholder:"è¼¸å…¥å­¸æ ¡åç¨± (ä¾‹å¦‚ï¼šå°åŒ—å¸‚ç«‹åœ‹èªå¯¦å°)",className:"flex-1 min-w-[200px] px-3 py-2 border-2 border-[#2D3436] rounded-lg font-medium",disabled:n}),e.jsx("button",{onClick:r,disabled:!a.trim()||n,className:"btn-pop px-4 py-2 bg-[#A29BFE] text-white font-bold disabled:opacity-50 flex items-center gap-1",children:n?"å»ºç«‹ä¸­...":e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"ğŸ«"})," å»ºç«‹å­¸æ ¡"]})})]})]})};export{V as default};
