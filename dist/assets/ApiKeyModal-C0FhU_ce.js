import{c as D,r as l,s as m,j as e,X as C,L as b,C as v,a as p,b as z}from"./index-CBp3GSCB.js";import{K as E,G as K}from"./key-RDmEU-JP.js";/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=D("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.469.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=D("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),M=({isOpen:n,onClose:I,currentUser:i})=>{const[a,h]=l.useState(""),[j,y]=l.useState(!1),[o,d]=l.useState(!1),[c,r]=l.useState(null),[f,x]=l.useState(""),[S,F]=l.useState(!0),[g,u]=l.useState(!1),[L,A]=l.useState("");l.useEffect(()=>{if(!n||!i)return;F(!0);const s=m.subscribe(t=>{const N=(t==null?void 0:t.apiKey)||"";x(N),h(N),F(!1)});return()=>s()},[n,i]),l.useEffect(()=>{if(!n||!i)return;(async()=>{try{const t=await z.getSharedApiKey(i.uid);t?(u(!0),A(t),localStorage.setItem("gemini_api_key",t)):(u(!1),A(""))}catch(t){console.error("æª¢æŸ¥å…±äº«æˆæ¬Šå¤±æ•—:",t),u(!1)}})()},[n,i]);const w=async()=>{if(a.trim()){d(!0);try{await m.save({apiKey:a.trim()}),x(a.trim()),r(null),localStorage.setItem("gemini_api_key",a.trim())}catch(s){console.error("å„²å­˜ API Key å¤±æ•—:",s),alert("å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦")}d(!1)}},k=async()=>{if(window.confirm("ç¢ºå®šè¦æ¸…é™¤ API Key å—ï¼Ÿ")){d(!0);try{await m.save({apiKey:""}),h(""),x(""),r(null),localStorage.removeItem("gemini_api_key")}catch(s){console.error("æ¸…é™¤ API Key å¤±æ•—:",s)}d(!1)}},P=async()=>{if(!a.trim()){r("error");return}y(!0),r(null);try{const s=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=${a.trim()}`,t=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:"å›ç­”ã€Œæ¸¬è©¦æˆåŠŸã€é€™å››å€‹å­—"}]}],generationConfig:{maxOutputTokens:10}})});t.ok?(r("success"),await m.save({apiKey:a.trim()}),x(a.trim()),localStorage.setItem("gemini_api_key",a.trim())):t.status===429?r("quota"):(t.status===400||t.status,r("error"))}catch(s){console.error("API æ¸¬è©¦å¤±æ•—:",s),r("network")}y(!1)},B=s=>!s||s.length<10?s:s.substring(0,6)+"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+s.substring(s.length-4);return n?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/40 backdrop-blur-sm p-2 sm:p-4",children:e.jsxs("div",{className:"card-pop w-full max-w-lg flex flex-col animate-in bg-[#FFF9E6]",children:[e.jsxs("div",{className:"p-3 sm:p-5 bg-[#FF9F43] border-b-3 border-[#2D3436] flex items-center justify-between",children:[e.jsxs("h3",{className:"font-black text-white flex items-center gap-2 text-lg sm:text-xl",children:[e.jsx(E,{size:24}),"API Key è¨­å®š"]}),e.jsx("button",{onClick:I,className:"btn-pop p-2 bg-white text-[#2D3436]",children:e.jsx(C,{size:20})})]}),e.jsx("div",{className:"p-4 sm:p-6 space-y-4",children:S?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(b,{size:32,className:"animate-spin text-[#FF9F43]"})}):e.jsxs(e.Fragment,{children:[g&&e.jsxs("div",{className:"bg-gradient-to-r from-[#1DD1A1]/20 to-[#54A0FF]/20 border-2 border-[#1DD1A1] rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-[#1DD1A1] rounded-full flex items-center justify-center flex-shrink-0",children:e.jsx(K,{size:24,className:"text-white"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-black text-[#1DD1A1] text-base",children:"ğŸ‰ ç®¡ç†å“¡å·²æˆæ¬Šæ‚¨ä½¿ç”¨å…±äº« API Keyï¼"}),e.jsx("p",{className:"text-sm text-[#2D3436] mt-1",children:"æ‚¨ç„¡éœ€è‡ªè¡Œç”³è«‹ API Keyï¼Œç³»çµ±å·²è‡ªå‹•ç‚ºæ‚¨è¨­å®šã€‚"})]})]}),e.jsx("div",{className:"mt-3 pt-3 border-t border-[#1DD1A1]/30",children:e.jsx("p",{className:"text-xs text-[#636E72]",children:"âœ“ å…±äº« API Key ç”±ç®¡ç†å“¡æä¾›ï¼Œå¯ç›´æ¥ä½¿ç”¨ç”Ÿæˆè©•èªåŠŸèƒ½"})})]}),!g&&e.jsxs("div",{className:"bg-[#54A0FF]/20 border-2 border-[#54A0FF] rounded-lg p-3 text-sm text-[#2D3436]",children:[e.jsx("p",{className:"font-bold mb-1",children:"ğŸ’¡ å¦‚ä½•å–å¾— API Keyï¼Ÿ"}),e.jsx("p",{className:"text-[#636E72]",children:"å‰å¾€ Google AI Studio ç”³è«‹å…è²»çš„ Gemini API Key"}),e.jsxs("a",{href:"https://accounts.google.com/v3/signin/identifier?continue=https%3A%2F%2Faistudio.google.com%2Fapikey&flowName=GlifWebSignIn&flowEntry=AddSession&Email=@gmail.com",target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-1 text-[#54A0FF] hover:underline font-bold mt-2",children:[e.jsx(G,{size:14}),"å‰å¾€ç”³è«‹ API Key"]})]}),e.jsxs("div",{className:"bg-[#FF6B6B]/15 border-2 border-[#FF6B6B] rounded-lg p-3 text-sm",children:[e.jsx("p",{className:"font-bold text-[#FF6B6B] mb-1",children:"âš ï¸ é‡è¦æé†’"}),e.jsxs("p",{className:"text-[#2D3436]",children:["è«‹ä½¿ç”¨",e.jsx("span",{className:"font-bold text-[#FF6B6B]",children:"ã€Œå€‹äºº Gmail å¸³è™Ÿã€"}),"ç”³è«‹ API Keyï¼"]}),e.jsx("p",{className:"text-[#636E72] text-xs mt-1",children:"å­¸æ ¡å¸³è™Ÿï¼ˆ@xxx.edu.twï¼‰ç”³è«‹çš„ API Key å¯èƒ½ç„¡æ³•æ­£å¸¸ä½¿ç”¨"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-bold text-[#2D3436]",children:"ç›®å‰ç‹€æ…‹ï¼š"}),g?e.jsxs("span",{className:"flex items-center gap-1 text-[#1DD1A1] font-bold",children:[e.jsx(K,{size:16}),"ä½¿ç”¨å…±äº« API Key"]}):f?e.jsxs("span",{className:"flex items-center gap-1 text-[#1DD1A1] font-bold",children:[e.jsx(v,{size:16}),"å·²è¨­å®š (",B(f),")"]}):e.jsxs("span",{className:"flex items-center gap-1 text-[#FF6B6B] font-bold",children:[e.jsx(p,{size:16}),"å°šæœªè¨­å®š"]})]}),e.jsxs("div",{className:"bg-white border-3 border-[#2D3436] rounded-lg p-4 shadow-[4px_4px_0_#2D3436]",children:[e.jsx("label",{className:"block text-sm sm:text-base font-black text-[#2D3436] mb-3 flex items-center gap-2",children:"ğŸ”‘ Gemini API Key"}),e.jsx("input",{type:"password",value:a,onChange:s=>{h(s.target.value),r(null)},placeholder:"è¼¸å…¥æ‚¨çš„ API Key...",className:`w-full p-3 sm:p-4 border-3 border-[#2D3436] rounded-lg text-base sm:text-lg text-[#2D3436] font-bold \r
                                               bg-[#FFF9E6] placeholder:text-[#636E72]/60 placeholder:font-medium\r
                                               focus:border-[#FF9F43] focus:ring-4 focus:ring-[#FF9F43]/20 outline-none\r
                                               transition-all duration-200`}),e.jsx("p",{className:"mt-2 text-xs text-[#636E72]",children:"ğŸ’¡ API Key æ ¼å¼ï¼šAIza... é–‹é ­çš„å­—ä¸²"})]}),c&&e.jsx("div",{className:`p-3 rounded-lg border-2 flex items-center gap-2 text-sm font-bold
                                  ${c==="success"?"bg-[#1DD1A1]/20 border-[#1DD1A1] text-[#1DD1A1]":"bg-[#FF6B6B]/20 border-[#FF6B6B] text-[#FF6B6B]"}`,children:c==="success"?e.jsxs(e.Fragment,{children:[e.jsx(v,{size:18}),"é€£ç·šæ¸¬è©¦æˆåŠŸï¼API Key å·²è‡ªå‹•å„²å­˜ âœ¨"]}):c==="quota"?e.jsxs(e.Fragment,{children:[e.jsx(p,{size:18}),e.jsxs("div",{children:[e.jsx("div",{children:"âŒ API å…è²»é¡åº¦å·²ç”¨å®Œï¼Œç„¡æ³•ä½¿ç”¨"}),e.jsx("div",{className:"text-xs font-normal mt-1",children:"è«‹æ˜å¤©å†è©¦æˆ–ä½¿ç”¨å…¶ä»– Google å¸³è™Ÿç”³è«‹æ–°çš„ API Key"})]})]}):c==="network"?e.jsxs(e.Fragment,{children:[e.jsx(p,{size:18}),"ç¶²è·¯é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯ç‹€æ…‹"]}):e.jsxs(e.Fragment,{children:[e.jsx(p,{size:18}),"é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æ˜¯å¦æ­£ç¢º"]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2",children:[e.jsx("button",{onClick:P,disabled:!a.trim()||j||o,className:"btn-pop flex-1 py-3 bg-[#54A0FF] text-white font-bold flex items-center justify-center gap-2 disabled:opacity-50",children:j?e.jsxs(e.Fragment,{children:[e.jsx(b,{size:18,className:"animate-spin"}),"æ¸¬è©¦ä¸­..."]}):e.jsx(e.Fragment,{children:"ğŸ§ª æ¸¬è©¦é€£ç·š"})}),e.jsx("button",{onClick:w,disabled:!a.trim()||o,className:"btn-pop flex-1 py-3 bg-[#1DD1A1] text-white font-bold disabled:opacity-50 flex items-center justify-center gap-2",children:o?e.jsxs(e.Fragment,{children:[e.jsx(b,{size:18,className:"animate-spin"}),"å„²å­˜ä¸­..."]}):e.jsx(e.Fragment,{children:"ğŸ’¾ å„²å­˜"})})]}),f&&e.jsx("button",{onClick:k,disabled:o,className:"w-full text-center text-sm text-[#FF6B6B] hover:underline font-bold disabled:opacity-50",children:"ğŸ—‘ï¸ æ¸…é™¤å·²å„²å­˜çš„ API Key"})]})}),e.jsxs("div",{className:"p-3 sm:p-4 bg-[#E8DCC8] border-t-2 border-dashed border-[#2D3436]/20 text-xs text-[#636E72] text-center flex items-center justify-center gap-1",children:[e.jsx(_,{size:14}),"API Key å®‰å…¨å„²å­˜æ–¼æ‚¨çš„å€‹äººå¸³è™Ÿï¼Œä¸æœƒèˆ‡ä»–äººå…±ç”¨"]})]})}):null};export{M as default};
