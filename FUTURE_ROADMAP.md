# 點石成金蜂🐝 未來發展建議藍圖

> 📅 更新時間：2026-01-11 22:00 | 已完成 **17 項功能** | v2.4.0

---

## 📊 目前完成進度

| # | 功能 | 狀態 | 版本 |
|---|------|------|------|
| 1 | 模組化架構 | ✅ 完成 | v1.0 |
| 2 | RWD 響應式設計 | ✅ 完成 | v1.0 |
| 3 | 教育手寫普普風 UI | ✅ 完成 | v1.0 |
| 4 | AI 評語生成 (Gemini 2.0 Flash) | ✅ 完成 | v1.0 |
| 5 | Firebase 資料持久化 | ✅ 完成 | v1.0 |
| 6 | API Key 管理介面 | ✅ 完成 | v1.0 |
| 7 | 單一學生即時生成 | ✅ 完成 | v1.0 |
| 8 | 評語範本庫 | ✅ 完成 | v1.0 |
| 9 | 成語搜尋與常用排序 | ✅ 完成 | v1.0 |
| 10 | 評語字數統計 | ✅ 完成 | v1.0 |
| 11 | PWA 離線支援 | ✅ 完成 | v2.0 |
| 12 | 班級管理系統 | ✅ 完成 | v2.0 |
| 13 | 歷史記錄與版本回溯 | ✅ 完成 | v2.0 |
| 14 | Google 登入與權限管理 | ✅ 完成 | v2.0 |
| 15 | **成語使用紀錄帳號隔離** | ✅ 完成 | v2.4 |
| 16 | **API 配額錯誤處理優化** | ✅ 完成 | v2.4 |
| 17 | **Excel 匯入 / 生成評語按鈕 UI 優化** | ✅ 完成 | v2.4 |

---

## 🆕 今日完成功能 (v2.4.0)

### 1. 成語使用紀錄帳號隔離
- `IdiomSidebar.jsx`：localStorage key 改為 `idiom_usage_${userId}`
- 切換帳號時各自保留獨立的常用成語記錄

### 2. API 配額錯誤處理優化
- `geminiApi.js`：429 錯誤時顯示「免費額度已用完」
- `ApiKeyModal.jsx`：測試連線時區分「Key 無效」與「配額用完」
- 新增橘色警告框顯示配額狀態

### 3. UI 優化
- `InputPanel.jsx`：Excel 匯入按鈕更大更醒目（綠色）
- `StudentTable.jsx`：生成評語按鈕排版更清晰
- `DashboardModal.jsx`：統計排除錯誤訊息，新增「生成失敗」分類

---

## 🎯 短期建議功能 (1-2 週)

### 1. 深色模式 ⭐⭐⭐
**預估時間**：3-4 小時

```
功能設計：
├── CSS 變數定義亮/暗色調色盤
├── Tailwind dark: 前綴支援
├── 系統偏好自動偵測 (prefers-color-scheme)
├── 使用者手動切換開關
└── 偏好設定持久化 (localStorage / Firebase)
```

---

### 2. 評語範本分類管理 ⭐⭐⭐
**預估時間**：3-4 小時

```
功能設計：
├── 範本分類（學業/品德/人際/服務/其他）
├── 分類標籤篩選
├── 範本使用次數統計
├── 範本變數插入（{{學生姓名}}）
└── 範本匯入/匯出
```

---

### 3. 鍵盤快捷鍵 ⭐⭐
**預估時間**：2-3 小時

| 快捷鍵 | 功能 |
|--------|------|
| Ctrl+S | 儲存當前評語 |
| Ctrl+G | 生成 AI 評語 |
| Ctrl+N | 新增學生 |
| Ctrl+F | 搜尋學生 |
| Esc | 關閉 Modal |

---

### 4. React.memo 效能優化 ⭐⭐
**預估時間**：2 小時

- `StudentCard` / `StudentTable` 加入 memo
- 使用 `useMemo` 快取排序/篩選結果
- 使用 `useCallback` 穩定事件處理函數

---

## 🔶 中期建議功能 (1-2 月)

### 5. TypeScript 遷移 ⭐⭐⭐⭐
**預估時間**：8-12 小時（漸進式）

```
遷移順序：
Phase 1：utils/*.ts, hooks/*.ts
Phase 2：firebase/*.ts + 定義 interfaces
Phase 3：components/*.tsx
```

**核心 Interface 定義**：
```typescript
interface Student {
  id: string;
  name: string;
  selectedTags: string[];
  manualTraits: string;
  comment: string;
  classId?: string;
}

interface Template {
  id: string;
  content: string;
  category: string;
  usageCount: number;
}
```

---

### 6. 單元測試建立 ⭐⭐⭐
**預估時間**：6-8 小時

```
技術選擇：
├── Vitest（與 Vite 無縫整合）
├── React Testing Library
├── MSW (Mock Service Worker)
└── 覆蓋率目標：核心服務 > 80%
```

---

### 7. 評語歷史比較功能 ⭐⭐
**預估時間**：2-3 小時

```
功能設計：
├── 雙欄比較視圖
├── 差異高亮顯示 (類似 Git diff)
├── 版本標註備註
└── 合併版本功能
```

---

### 8. 批次套用範本 ⭐⭐
**預估時間**：2-3 小時

```
功能設計：
├── 勾選多位學生
├── 選擇範本 → 批次套用
├── 變數自動替換
└── 預覽確認視窗
```

---

## 🚀 長期建議功能 (3-6 月)

### 9. AI 評語品質分析 ⭐⭐⭐
**預估時間**：3-4 小時

- 字數分析（過長/過短警告）
- 詞彙多樣性檢測
- 正向/負向語氣分析
- 改寫建議（調用 Gemini）
- 評語品質分數

---

### 10. 學生進步追蹤 ⭐⭐⭐
**預估時間**：4-6 小時

- 學期設定（上/下學期）
- 定期評語快照
- 進步趨勢圖表
- 特質變化追蹤
- 學期報告生成

---

### 11. 即時協作功能 ⭐⭐
**預估時間**：8-12 小時

- Firestore onSnapshot 即時同步
- 多教師協作編輯同一班級
- 編輯鎖定機制
- 衝突解決策略

---

### 12. 多語言支援 (i18n) ⭐⭐
**預估時間**：4-6 小時

- react-i18next
- 支援：繁中/簡中/英文
- 日期/數字格式本地化

---

## 🔧 技術債清單

| 項目 | 優先級 | 說明 |
|------|--------|------|
| TypeScript 遷移 | ⭐⭐⭐⭐ | 增強型別安全 |
| 單元測試 | ⭐⭐⭐ | Vitest + RTL |
| 虛擬滾動 | ⭐⭐ | 大量學生效能優化 |
| 錯誤邊界強化 | ⭐⭐ | 分區 Error Boundary |
| 無障礙優化 | ⭐⭐ | ARIA 標籤、焦點管理 |
| console.log 清理 | ⭐ | DEV 環境限定 |

---

## 📅 開發時程建議

### 短期 (1-2 週)
1. ✅ 深色模式
2. ✅ 範本分類管理
3. ✅ 鍵盤快捷鍵
4. ✅ React.memo 優化

### 中期 (1-2 月)
1. ✅ TypeScript Phase 1-2
2. ✅ 單元測試建立
3. ✅ 評語歷史比較
4. ✅ 批次套用範本

### 長期 (3-6 月)
1. ✅ TypeScript 完整遷移
2. ✅ AI 評語品質分析
3. ✅ 學生進步追蹤
4. ✅ 即時協作（如需求）

---

## 🏆 版本歷史

| 版本 | 日期 | 主要更新 |
|------|------|----------|
| v2.4.0 | 2026-01-11 | 成語帳號隔離、API 配額處理、UI 優化 |
| v2.3.0 | 2026-01-11 | WebView 偵測、RWD 修復、PDF 改良 |
| v2.0.0 | 2026-01-11 | Google 登入、管理員審核、班級管理 |
| v1.0.0 | 2026-01-10 | 初版：AI 評語生成、Firebase 持久化 |

---

## 📁 專案結構

```
h:\comments\
├── src/
│   ├── components/         # 26 個元件
│   ├── firebase/           # 4 個服務模組
│   ├── hooks/              # 2 個 Custom Hooks
│   ├── utils/              # 3 個工具函數
│   ├── data/               # 2 個靜態資料
│   └── contexts/           # 1 個 Context
├── firestore.rules         # Firestore 安全規則
└── package.json            # v2.4.0
```

---

> 💡 **下一步建議**：實作「深色模式」，提升夜間使用體驗，技術難度低且使用者感受度高。
